<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
    <title>pert.dev</title>
    <subtitle>Pert&#x27;s personal site</subtitle>
    <link rel="self" type="application/atom+xml" href="https://pert.dev/atom.xml"/>
    <link rel="alternate" type="text/html" href="https://pert.dev"/>
    <generator uri="https://www.getzola.org/">Zola</generator>
    <updated>2025-12-24T00:00:00+00:00</updated>
    <id>https://pert.dev/atom.xml</id>
    <entry xml:lang="en">
        <title>PLEASE name your type generics</title>
        <published>2025-12-24T00:00:00+00:00</published>
        <updated>2025-12-24T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://pert.dev/posts/please-name-your-generics/"/>
        <id>https://pert.dev/posts/please-name-your-generics/</id>
        
        <content type="html" xml:base="https://pert.dev/posts/please-name-your-generics/">&lt;p&gt;WHY as software engineers when, depite all the &lt;a href=&quot;https:&#x2F;&#x2F;programmerhumor.io&#x2F;programming-memes&#x2F;poor-little-i&#x2F;&quot;&gt;memes&lt;&#x2F;a&gt;, we&#x27;ve agreed pretty unanimously that we should use descriptive names for things, can we still not be arsed
to properly name our type generics. The compiler supports more than one character people! We insist on the importance of readability, and yet as soon as we get to types
our developer monkey brains seem to resort back to &lt;code&gt;U&lt;&#x2F;code&gt; or &lt;code&gt;T&lt;&#x2F;code&gt;. This may be fine (debatable) for short functions with one type parameter, but as soon as we get to more than one
why are we making our lives harder than they need to be. Your LSP supports renaming them! You&#x27;re one code action away from just slightly improving the readability of your codebase.&lt;&#x2F;p&gt;
&lt;p&gt;Take this little snippet I yoinked from some code I wrote the other day.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;validate_and_transform&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;T, U, V, W&amp;gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;field_name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;str&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span&gt;HashMap&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span&gt;, serde_json&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;::&lt;&#x2F;span&gt;&lt;span&gt;Value&amp;gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;validator&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; U,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;transformer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; V,
&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;-&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Option&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;W&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;where
&lt;&#x2F;span&gt;&lt;span&gt;    T&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; DeserializeOwned,
&lt;&#x2F;span&gt;&lt;span&gt;    U&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; Fn(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span&gt;T) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;bool&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    V&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; Fn(T) -&amp;gt; W,
&lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    map&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;get&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;build_key_from_field&lt;&#x2F;span&gt;&lt;span&gt;(field_name))
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;cloned&lt;&#x2F;span&gt;&lt;span&gt;()
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;and_then&lt;&#x2F;span&gt;&lt;span&gt;(|&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;v&lt;&#x2F;span&gt;&lt;span&gt;| serde_json&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;::&lt;&#x2F;span&gt;&lt;span&gt;from_value(v)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;ok&lt;&#x2F;span&gt;&lt;span&gt;())
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;and_then&lt;&#x2F;span&gt;&lt;span&gt;(|&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;v&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; T| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;validator&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span&gt;v)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;then_some&lt;&#x2F;span&gt;&lt;span&gt;(v))
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span&gt;(transformer)
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Now lets make this nicer&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;validate_and_transform&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;Raw, Validator, Transformer, &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Result&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;field_name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;str&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span&gt;HashMap&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span&gt;, serde_json&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;::&lt;&#x2F;span&gt;&lt;span&gt;Value&amp;gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;validator&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; Validator,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;transformer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; Transformer,
&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;-&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Option&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Result&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;where
&lt;&#x2F;span&gt;&lt;span&gt;    Raw&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; DeserializeOwned,
&lt;&#x2F;span&gt;&lt;span&gt;    Validator&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; Fn(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span&gt;Raw) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;bool&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    Transformer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; Fn(Raw) -&amp;gt; Result,
&lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    map&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;get&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;build_key_from_field&lt;&#x2F;span&gt;&lt;span&gt;(field_name))
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;cloned&lt;&#x2F;span&gt;&lt;span&gt;()
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;and_then&lt;&#x2F;span&gt;&lt;span&gt;(|&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;v&lt;&#x2F;span&gt;&lt;span&gt;| serde_json&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;::&lt;&#x2F;span&gt;&lt;span&gt;from_value(v)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;ok&lt;&#x2F;span&gt;&lt;span&gt;())
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;and_then&lt;&#x2F;span&gt;&lt;span&gt;(|&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;v&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; Raw| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;validator&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span&gt;v)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;then_some&lt;&#x2F;span&gt;&lt;span&gt;(v))
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span&gt;(transformer)
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;isn&#x27;t that so much better! We can take it one step further by adding in the type parameter to the serde call&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;validate_and_transform&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;Raw, Validator, Transformer, &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Result&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;(
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;field_name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;str&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span&gt;HashMap&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;String&lt;&#x2F;span&gt;&lt;span&gt;, serde_json&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;::&lt;&#x2F;span&gt;&lt;span&gt;Value&amp;gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;validator&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; Validator,
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;transformer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; Transformer,
&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;-&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Option&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Result&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;where
&lt;&#x2F;span&gt;&lt;span&gt;    Raw&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; DeserializeOwned,
&lt;&#x2F;span&gt;&lt;span&gt;    Validator&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; Fn(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span&gt;Raw) -&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;bool&lt;&#x2F;span&gt;&lt;span&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;    Transformer&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; Fn(Raw) -&amp;gt; Result,
&lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    map&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;get&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;build_key_from_field&lt;&#x2F;span&gt;&lt;span&gt;(field_name))
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;cloned&lt;&#x2F;span&gt;&lt;span&gt;()
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;and_then&lt;&#x2F;span&gt;&lt;span&gt;(|&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;v&lt;&#x2F;span&gt;&lt;span&gt;| serde_json&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;::&lt;&#x2F;span&gt;&lt;span&gt;from_value&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;::&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;Raw&amp;gt;(v)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;ok&lt;&#x2F;span&gt;&lt;span&gt;())
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;and_then&lt;&#x2F;span&gt;&lt;span&gt;(|&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;v&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; Raw| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;validator&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span&gt;v)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;then_some&lt;&#x2F;span&gt;&lt;span&gt;(v))
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span&gt;(transformer)
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;I&#x27;ve found LLMs are equally culpable of this, so its still on you to make sure your code is readable.&lt;&#x2F;p&gt;
&lt;p&gt;People much smarter than me &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;tokio-rs&#x2F;tokio&#x2F;blob&#x2F;d666068be7489a7ff49b3ac3f6b61ccee0839972&#x2F;tokio-util&#x2F;src&#x2F;codec&#x2F;framed_read.rs#L180&quot;&gt;example&lt;&#x2F;a&gt; are equally
gullible of doing this, I think its just somewhere we can each make each others lives that little bit easier.&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Take the time to set up good personal infrastructure for your personal sites.</title>
        <published>2025-06-10T00:00:00+00:00</published>
        <updated>2025-06-10T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://pert.dev/posts/take-the-time-to-set-up-good-infrastructure/"/>
        <id>https://pert.dev/posts/take-the-time-to-set-up-good-infrastructure/</id>
        
        <content type="html" xml:base="https://pert.dev/posts/take-the-time-to-set-up-good-infrastructure/">&lt;p&gt;Title says it all really.&lt;&#x2F;p&gt;
&lt;p&gt;There has been a recent, welcome wave risen by the tides of AI in personal computing, or the &quot;decentralized web&quot; or the &quot;indie web&quot; - whatever you want to call it.&lt;&#x2F;p&gt;
&lt;p&gt;Effectively this is people feeling more empowered to host their own highly personalised software, now that the barrier to entry has been massively lowered - both in price point
over the last decade or so, and also much more recently in the skill&#x2F;knowledge level required to do it.&lt;&#x2F;p&gt;
&lt;p&gt;Despite being a software engineer by trade, I was not immune to this either. I had hosted a relatively modest personal site for a number of years, but it wasn&#x27;t until somewhat recently
that I felt inspired enough to begin hosting my own software, open source projects, more refined blog etc.&lt;&#x2F;p&gt;
&lt;p&gt;This post is a short one - and is targeted to those perhaps getting started in this space. All I want to say is that you should take the time, just as you would if deploying
a large production system, in your developer tooling. Building, deploying and launching your own software should be fun, but you know whats not fun (except to anarchsists)?
Manual deployments, silent broken builds, or having to ssh into your VPS to deal with a systemctl configuration issue.&lt;&#x2F;p&gt;
&lt;p&gt;Take the time when setting up whatever you&#x27;re setting up, to make it as easy as possible to ship your code! This is so obvious in the software engineering world, but since my
mindset was always &quot;eh its just my personal site&quot;, it took me far too long to get to this point.&lt;&#x2F;p&gt;
&lt;p&gt;The added friction to just simply writing a new blog post, or &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rupert648&#x2F;pert.dev&#x2F;blob&#x2F;main&#x2F;services&#x2F;glance&#x2F;glance.yml&quot;&gt;updating my glance config&lt;&#x2F;a&gt; meant that my lazy
ass just became uninspired to do any of it.&lt;&#x2F;p&gt;
&lt;p&gt;So, PSA: take the couple of hours to write your build and deployment scripts for your crappy little personal project, it&#x27;ll inspire you to work on it more once the boring stuff is out the way.
These can be as minimal or inventive as you&#x27;d like (&lt;a href=&quot;https:&#x2F;&#x2F;pert.dev&#x2F;posts&#x2F;easy-pr-previews&#x2F;&quot;&gt;read my blog about creating your own pr preview deployments please!&lt;&#x2F;a&gt;). But you&#x27;ll thank yourself later&lt;&#x2F;p&gt;
&lt;p&gt;If you need some inspo, feel free to steal some of my bash scripts&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;https:&#x2F;&#x2F;github.com&#x2F;rupert648&#x2F;pert.dev&#x2F;blob&#x2F;main&#x2F;scripts&#x2F;deploy.sh&lt;&#x2F;li&gt;
&lt;li&gt;https:&#x2F;&#x2F;github.com&#x2F;rupert648&#x2F;pert.dev&#x2F;blob&#x2F;main&#x2F;scripts&#x2F;preview.sh&lt;&#x2F;li&gt;
&lt;li&gt;https:&#x2F;&#x2F;github.com&#x2F;rupert648&#x2F;pert.dev&#x2F;blob&#x2F;main&#x2F;scripts&#x2F;cleanup-preview.sh&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>My growing lack of trust in typescript code</title>
        <published>2025-02-17T00:00:00+00:00</published>
        <updated>2025-02-17T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://pert.dev/posts/ts-growing-lack-of-trust/"/>
        <id>https://pert.dev/posts/ts-growing-lack-of-trust/</id>
        
        <content type="html" xml:base="https://pert.dev/posts/ts-growing-lack-of-trust/">&lt;h2 id=&quot;introduction&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#introduction&quot; aria-label=&quot;Anchor link for: introduction&quot;&gt;Introduction&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;I have worked both on large scale high traffic Typescript and Rust systems, and most recently a weird mutation of the two through &lt;a href=&quot;https:&#x2F;&#x2F;napi.rs&#x2F;&quot;&gt;napi-rs&lt;&#x2F;a&gt;.
Whilst there are plenty more experienced than I, this most recent adventure has given me a unique point of reference on the differences, pain points and benefits of each.&lt;&#x2F;p&gt;
&lt;p&gt;Firstly I want to preface by saying I &lt;em&gt;love&lt;&#x2F;em&gt; typescript, I try and stay away from the types vs untyped debate on various social medias for my own sanity, but once you reach a project
of an even moderate size, I will admit I really struggle to see how the untyped side of the debate isn&#x27;t massively overshadowed by the benefits that type safety brings. Furthermore, none
of the ideas I am presenting here are novel, in fact they have been talked about in length, I just wanted an outlet for my own pain.&lt;&#x2F;p&gt;
&lt;p&gt;So what is this article all about? If typescript is so great and so much better than Javascript, why is my distrust in typescript code, day to day, still growing?
This article, I guess, is now just a further extension of these type philosophies and as I hope to demonstrate in this article, genuine practicalities I&#x27;ve found of extending this type
safety one step further beyond typescript, and how doing to so elevates the level of reliability you can have in your software.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;types&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#types&quot; aria-label=&quot;Anchor link for: types&quot;&gt;Types&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;There are a million and one articles out on the internet over why types are beneficial, and I don&#x27;t expect to convince you in this one article, I just hope to show you some examples of why
even Typescript has its limitations over a more strongly run-time typed language; in this case Rust.&lt;&#x2F;p&gt;
&lt;div class=&quot;note-container&quot;&gt;
  
    &lt;div class=&quot;note-header&quot;&gt;
      
        &lt;div class=&quot;note-center&quot;&gt;
        
        &lt;&#x2F;div&gt;
      
    &lt;&#x2F;div&gt;
    &lt;div class=&quot;note-content&quot;&gt;
      &lt;p&gt;Typescript&#x27;s safety is only as strong as the programmers motivation to use it.&lt;&#x2F;p&gt;

    &lt;&#x2F;div&gt;
  
&lt;&#x2F;div&gt;
&lt;p&gt;As I&#x27;m sure most readers of this article are aware, Typescript is a &lt;em&gt;compile time&lt;&#x2F;em&gt; typed language. Type checks are only enforced at the time of compilation, and to ensure types are satisfied at runtime
runtime checks must be introduced. Entire libraries are dedicated to this functionality such as &lt;a href=&quot;https:&#x2F;&#x2F;zod.dev&#x2F;&quot;&gt;zod.dev&lt;&#x2F;a&gt;. This leads to my and many people&#x27;s first gripe; Typescripts safety is only as strong
as the programmers motivation to use it.&lt;&#x2F;p&gt;
&lt;p&gt;The most obvious example of this is the &lt;code&gt;any&lt;&#x2F;code&gt; type; cant be arsed to fill out that annoying type definition? Stick an &lt;code&gt;any&lt;&#x2F;code&gt; in there and you&#x27;re good to go. There. You&#x27;ve just made typescript obsolete,
albeit in a very transparent way. This is easily rectified in any sensible project; just disable any. But its also still surprisingly easy to lie to the compiler, heres an example;&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;ts&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-ts &quot;&gt;&lt;code class=&quot;language-ts&quot; data-lang=&quot;ts&quot;&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;interface &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;User &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;  name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;string&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  age&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;number&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;&#x2F;&#x2F; This is clearly wrong, but TypeScript accepts it
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span&gt;fakeUser &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span&gt;{} &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;User&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;  &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;&#x2F;&#x2F; No error, even though properties are missing
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;console&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;log&lt;&#x2F;span&gt;&lt;span&gt;(fakeUser&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;toUpperCase&lt;&#x2F;span&gt;&lt;span&gt;())&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;  &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;&#x2F;&#x2F; TypeError: Cannot read properties of undefined
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This kind of pattern is actually extremely common. The best and most frequent example I have seen is when reading some external IO source, such as the response from a service.
Each time I encounter this pattern in production code, my trust erodes a little more. What started as a strongly-typed promise becomes a game of &#x27;hope the runtime data matches our types&#x27;.&lt;&#x2F;p&gt;
&lt;p&gt;I mentioned above our mutant typescript-rust project I am currently working on, where we are slowly migrating the typescript code to rust, and one of the most common forms of bugs we face is
when translating the typescript objects to rust structs, our typescript types for services responses were wrong!&lt;&#x2F;p&gt;
&lt;p&gt;Take the above example&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;ts&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-ts &quot;&gt;&lt;code class=&quot;language-ts&quot; data-lang=&quot;ts&quot;&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;User &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;  name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;string&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  age&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;number&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Converting this to rust would give the following struct&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;#&lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;derive&lt;&#x2F;span&gt;&lt;span&gt;(Deserialize&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;,&lt;&#x2F;span&gt;&lt;span&gt; Serialize)]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;struct &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;User &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;  name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; String;
&lt;&#x2F;span&gt;&lt;span&gt;  age&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; String;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Now lets look at the typescript code to read this response from a service:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;ts&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-ts &quot;&gt;&lt;code class=&quot;language-ts&quot; data-lang=&quot;ts&quot;&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;async function &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;fetchUser&lt;&#x2F;span&gt;&lt;span&gt;()&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;Promise&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;User&lt;&#x2F;span&gt;&lt;span&gt;&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span&gt;response &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;await &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;fetch&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;#39;&#x2F;api&#x2F;user&amp;#39;&lt;&#x2F;span&gt;&lt;span&gt;)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span&gt;data &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;await &lt;&#x2F;span&gt;&lt;span&gt;response&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;json&lt;&#x2F;span&gt;&lt;span&gt;()&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span&gt;data &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;User&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;  
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;And the rust code:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span&gt;async &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;fetch_user&lt;&#x2F;span&gt;&lt;span&gt;() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;-&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Result&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;User, &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Box&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;dyn Error&amp;gt;&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; response &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span&gt;reqwest&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;::&lt;&#x2F;span&gt;&lt;span&gt;get(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;&#x2F;api&#x2F;user&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span&gt;await&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;?&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; user&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; User &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span&gt; response&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;json&lt;&#x2F;span&gt;&lt;span&gt;()&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span&gt;await&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;?&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Ok&lt;&#x2F;span&gt;&lt;span&gt;(user)
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Now lets say we get such a response from our api service&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;json&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-json &quot;&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f51818;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;Rupert&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;So now we&#x27;ve actually moved to rust, we noticed that our typescript code was &lt;em&gt;wrong&lt;&#x2F;em&gt;. The rust code would blowup immediately at our &lt;code&gt;response.json()&lt;&#x2F;code&gt; line, whilst the typescript code would trundle
happily on. Whilst an error is never fun, this is a good thing! We have &lt;em&gt;failed fast and early&lt;&#x2F;em&gt;. From this translation we&#x27;ve immediately caught a bug,
which if left to fester in the typescript code as an unknown &lt;code&gt;undefined&lt;&#x2F;code&gt; could have hurt us in more subtle, but painful ways.
This is where my trust really started to crack. We had months of production TypeScript code running with incorrect types, silently accepting malformed data.
The compiler happily verified our lies, while Rust refused to participate in our self-deception.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;error-handling&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#error-handling&quot; aria-label=&quot;Anchor link for: error-handling&quot;&gt;Error Handling&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;div class=&quot;note-container&quot;&gt;
  
    &lt;div class=&quot;note-header&quot;&gt;
      
        &lt;div class=&quot;note-center&quot;&gt;
        
        &lt;&#x2F;div&gt;
      
    &lt;&#x2F;div&gt;
    &lt;div class=&quot;note-content&quot;&gt;
      &lt;p&gt;Try catch is like throwing a glass of water into a crowded room, where everyone is blindfolded, and expecting the glass to be caught without spilling a drop.&lt;&#x2F;p&gt;

    &lt;&#x2F;div&gt;
  
&lt;&#x2F;div&gt;
&lt;p&gt;The next thing I want to talk about is error handling.
Notice in the rust code how we had to &lt;strong&gt;explicitly&lt;&#x2F;strong&gt; handle all the possible errors.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span&gt;async &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;fetch_user&lt;&#x2F;span&gt;&lt;span&gt;() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;-&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Result&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;User, &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Box&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;dyn Error&amp;gt;&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; response &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span&gt;reqwest&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;::&lt;&#x2F;span&gt;&lt;span&gt;get(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;&#x2F;api&#x2F;user&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span&gt;await&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;?&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; user&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; User &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span&gt; response&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;json&lt;&#x2F;span&gt;&lt;span&gt;()&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span&gt;await&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;expect&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;User API response didn&amp;#39;t match expected shape.&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Ok&lt;&#x2F;span&gt;&lt;span&gt;(user)
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;ul&gt;
&lt;li&gt;our function returns &lt;code&gt;Result&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;our use of reqwest uses &lt;code&gt;?&lt;&#x2F;code&gt; to subtly the error case of &lt;code&gt;request::get&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;our use of reqwest uses &lt;code&gt;?&lt;&#x2F;code&gt; to subtly the error case of &lt;code&gt;response.json()&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;This comes on to my next big gripe - not just with typescript but far too many other languages - try catch error handling.
God, after writing production rust code as my main output for a number of months now, I &lt;em&gt;&lt;strong&gt;HATE&lt;&#x2F;strong&gt;&lt;&#x2F;em&gt; try catch with a burning passion.
Try catch is like throwing a glass of water into a crowded room, where everyone is blindfolded, and expecting the glass to be caught without spilling a drop.&lt;&#x2F;p&gt;
&lt;p&gt;When calling a function in TypeScript, you literally have no idea whether that function will return an error or not!
It&#x27;s so crazy after getting used to constructs like Result in Rust or _val, err in Go.
In TypeScript, you&#x27;re basically working blind - any function could throw at any time, for any reason, and the type system gives you zero help.
You can&#x27;t tell by looking at a function signature whether it might explode in your face.
The worst part is that this invisibility of errors means they often go unhandled, bubbling up through your application until they crash something important.
Meanwhile, Rust and Go and a number of other languages which aren&#x27;t java or javascript force you to acknowledge and handle errors explicitly - the compiler won&#x27;t let you ignore them.
It&#x27;s like the difference between walking through a minefield with a metal detector versus walking through blindfolded and hoping for the best. Or even better, in languages
such as Rust there are literal signs marking exactly where a bomb lies.
As so many others have emphasised in the past, try-catch feels like a trust exercise gone wrong.
When I call a TypeScript function, I have to trust that someone, somewhere, has handled all possible errors, or blindly throw on my own error handling logic just in case.
After seeing too many unhandled promise rejections in production, that trust is hard to maintain.&lt;&#x2F;p&gt;
&lt;div class=&quot;note-container&quot;&gt;
  
    &lt;div class=&quot;note-header&quot;&gt;
      
        &lt;div class=&quot;note-center&quot;&gt;
        
        &lt;&#x2F;div&gt;
      
    &lt;&#x2F;div&gt;
    &lt;div class=&quot;note-content&quot;&gt;
      &lt;p&gt;Typescript types are an exercise in convincing, rust types are an exercise of proof.&lt;&#x2F;p&gt;

    &lt;&#x2F;div&gt;
  
&lt;&#x2F;div&gt;
&lt;p&gt;Sometimes, I want everything to blowup, because it means some error in my logic. But the key difference is that in rust &lt;em&gt;I have explicit control over this&lt;&#x2F;em&gt;.
Lets return one last time to our user example. Lets say in this case we own the user api, and we are handling the response from another microservice we control.
In this case, if our struct is incorrect, it makes sense to completely blow up, as this indicates some error with our own implementation either on
this service or the user api service which we own. This is distinct from an input from an uncontrolled source such as user input.&lt;&#x2F;p&gt;
&lt;p&gt;In rust, we can make this super easy.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span&gt;async &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;fetch_user&lt;&#x2F;span&gt;&lt;span&gt;() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;-&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Result&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;User, &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Box&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;dyn Error&amp;gt;&amp;gt; {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; response &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span&gt;reqwest&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;::&lt;&#x2F;span&gt;&lt;span&gt;get(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;&#x2F;api&#x2F;user&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span&gt;await&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;?&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; user&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:&lt;&#x2F;span&gt;&lt;span&gt; User &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span&gt; response&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;json&lt;&#x2F;span&gt;&lt;span&gt;()&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span&gt;await&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;expect&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;User API response didn&amp;#39;t match expected shape.&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;Ok&lt;&#x2F;span&gt;&lt;span&gt;(user)
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Of course this is possible in TS as well, but remember what I said about effort in TS? We have to go through and add the blowup logic ourselves, using some validation library such
as zod or other, or go and throw down a bunch of the ugly and dreaded &lt;code&gt;if (user.name &amp;amp;&amp;amp; typeof user.name === &#x27;string&#x27;)...&lt;&#x2F;code&gt;. My key point is this; Typescript types are an exercise in convincing, rust types are an exercise of proof.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;conclusion&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#conclusion&quot; aria-label=&quot;Anchor link for: conclusion&quot;&gt;Conclusion&lt;&#x2F;a&gt;&lt;&#x2F;h3&gt;
&lt;p&gt;This isn&#x27;t about TypeScript being bad - it&#x27;s about understanding its limitations.
My trust hasn&#x27;t eroded because TypeScript failed to deliver on its promises, but because those promises were more modest than we initially assumed.
As our systems grow more complex, we need guarantees, not gentle suggestions. We need proof, not trust.&lt;&#x2F;p&gt;
&lt;p&gt;Is this article telling you to stop using Typescript and rewrite everything in rust? Of course not! Typescript is and will likely be for a long time
my go to language for hobby projects and spinning up prototypes quickly, but lets just set reasonable expectations on what we can expect to achieve with only compilation time guarantees.&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Your PR Previews Don&#x27;t Need Vercel: My solution on a $5 VPS using Cloudflare and Github Actions</title>
        <published>2024-12-30T00:00:00+00:00</published>
        <updated>2024-12-30T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://pert.dev/posts/easy-pr-previews/"/>
        <id>https://pert.dev/posts/easy-pr-previews/</id>
        
        <content type="html" xml:base="https://pert.dev/posts/easy-pr-previews/">&lt;h1 id=&quot;diy-pr-preview-deployments-it-s-easier-than-you-think&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#diy-pr-preview-deployments-it-s-easier-than-you-think&quot; aria-label=&quot;Anchor link for: diy-pr-preview-deployments-it-s-easier-than-you-think&quot;&gt;DIY PR Preview Deployments: It&#x27;s Easier Than You Think!&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;Let&#x27;s preface this by admitting that the title is a little farcical - the fact that Vercel and other similar sites give you preview domains out of the box with no setup is a lovely feature. This blog is purely to show you that it&#x27;s actually possible to configure these yourself, and furthermore, it&#x27;s way easier than you might think!&lt;&#x2F;p&gt;
&lt;p&gt;To give you some context, my site &lt;a href=&quot;https:&#x2F;&#x2F;pert.dev&quot;&gt;pert.dev&lt;&#x2F;a&gt; is built on &lt;a href=&quot;https:&#x2F;&#x2F;www.getzola.org&#x2F;&quot;&gt;Zola&lt;&#x2F;a&gt; - a static site which I serve on my $5 VPS from Linode, using &lt;a href=&quot;https:&#x2F;&#x2F;caddyserver.com&#x2F;&quot;&gt;Caddy&lt;&#x2F;a&gt;. I use &lt;a href=&quot;https:&#x2F;&#x2F;www.cloudflare.com&#x2F;en-gb&#x2F;&quot;&gt;Cloudflare&lt;&#x2F;a&gt; as my domain registrar and for DNS. While my setup (which I&#x27;ll link to at the end if you want to skip ahead) is specific to these tools, my goal for this blog is to demonstrate that the core technologies for setting this up yourself are actually &lt;em&gt;easy-peasy&lt;&#x2F;em&gt;, regardless of your stack.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;pr-previews-the-big-picture&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#pr-previews-the-big-picture&quot; aria-label=&quot;Anchor link for: pr-previews-the-big-picture&quot;&gt;PR-Previews: The Big Picture&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;At their heart, PR previews are surprisingly simple and can be broken down into three main components. We&#x27;ll dive deep into each one, but here&#x27;s the overview:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;DNS Management&lt;&#x2F;strong&gt;: Creating a new A record for our preview subdomain&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;File Deployment&lt;&#x2F;strong&gt;: Getting our PR changes somewhere they can be served&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;Web Server Config&lt;&#x2F;strong&gt;: Telling our web server how to serve these files&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;The beauty is that these concepts apply whether you&#x27;re running Next.js, Ruby on Rails, or a static site like mine.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;initial-setup&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#initial-setup&quot; aria-label=&quot;Anchor link for: initial-setup&quot;&gt;Initial Setup&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;First, let&#x27;s create the files we&#x27;ll need in our repository:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;mkdir&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -p&lt;&#x2F;span&gt;&lt;span&gt; .github&#x2F;workflows
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;touch&lt;&#x2F;span&gt;&lt;span&gt; .github&#x2F;workflows&#x2F;pr-preview.yml
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;We&#x27;ll give this workflow some basic setup to run on PRs:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;yml&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-yml &quot;&gt;&lt;code class=&quot;language-yml&quot; data-lang=&quot;yml&quot;&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;PR Preview
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;on&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;pull_request&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;types&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;opened&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;synchronize&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;reopened&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;permissions&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;pull-requests&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;write
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;jobs&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;deploy-preview&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;runs-on&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;ubuntu-latest
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;steps&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;      - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;uses&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;actions&#x2F;checkout@v3
&lt;&#x2F;span&gt;&lt;span&gt;      
&lt;&#x2F;span&gt;&lt;span&gt;      - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;Get PR number
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;id&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;pr
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;run&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;echo &amp;quot;PR_NUMBER=pr-${{ github.event.pull_request.number }}&amp;quot; &amp;gt;&amp;gt; $GITHUB_OUTPUT
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;      - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;Deploy Preview
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;run&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;|
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;          chmod +x .&#x2F;scripts&#x2F;preview.sh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;          .&#x2F;scripts&#x2F;preview.sh
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;I&#x27;m not going to deep-dive into GitHub Actions here, but we&#x27;ve added the essential steps: checkout the repo, grab the PR number (which we&#x27;ll use later), and run our deployment script.&lt;&#x2F;p&gt;
&lt;p&gt;Next, let&#x27;s create our script file:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;mkdir&lt;&#x2F;span&gt;&lt;span&gt; scripts &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# if it doesn&amp;#39;t exist already
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;touch&lt;&#x2F;span&gt;&lt;span&gt; scripts&#x2F;preview.sh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;chmod&lt;&#x2F;span&gt;&lt;span&gt; +x scripts&#x2F;preview.sh
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;part-1-dns-magic-easier-than-you-think&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#part-1-dns-magic-easier-than-you-think&quot; aria-label=&quot;Anchor link for: part-1-dns-magic-easier-than-you-think&quot;&gt;Part 1: DNS Magic - Easier Than You Think&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;You don&#x27;t need to be a DNS wizard to get this working, but if you&#x27;re curious about the details, I&#x27;ll point you to some great resources on &lt;a href=&quot;https:&#x2F;&#x2F;www.cloudflare.com&#x2F;en-gb&#x2F;learning&#x2F;dns&#x2F;what-is-dns&#x2F;&quot;&gt;DNS basics&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;This part assumes two things:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;You own the domain and can update DNS records&lt;&#x2F;li&gt;
&lt;li&gt;You have API access to your DNS provider (I&#x27;ll show Cloudflare, but most providers have similar APIs)&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;PR previews typically use a subdomain pattern like &lt;code&gt;pr-123.yourdomain.com&lt;&#x2F;code&gt;. Creating this is surprisingly straightforward - we just need an A record pointing to our server&#x27;s IP. If your site is already live, you probably have something like:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#fafafa;color:#61676c;&quot;&gt;&lt;code&gt;&lt;span&gt;A record
&lt;&#x2F;span&gt;&lt;span&gt;yourdomain.com (or @)
&lt;&#x2F;span&gt;&lt;span&gt;253.253.253.253
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;For our preview, we&#x27;ll create a similar record but with our PR subdomain. Here&#x27;s how we do it via the Cloudflare API:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;setup_dns&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;local &lt;&#x2F;span&gt;&lt;span&gt;preview_id&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;1
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;local &lt;&#x2F;span&gt;&lt;span&gt;server_ip&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;253.253.253.253&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# Check if record exists
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;local &lt;&#x2F;span&gt;&lt;span&gt;existing_record&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;curl&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -s -X&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt; GET &amp;quot;https:&#x2F;&#x2F;api.cloudflare.com&#x2F;client&#x2F;v4&#x2F;zones&#x2F;$&lt;&#x2F;span&gt;&lt;span&gt;{CLOUDFLARE_ZONE_ID}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&#x2F;dns_records?name=$&lt;&#x2F;span&gt;&lt;span&gt;{preview_id}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;.yourdomain.com&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;\
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;        -H &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;Authorization: Bearer $&lt;&#x2F;span&gt;&lt;span&gt;{CLOUDFLARE_API_TOKEN}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;\
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;        -H &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;Content-Type: application&#x2F;json&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;if &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;echo &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;$&lt;&#x2F;span&gt;&lt;span&gt;existing_record&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;grep&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -q &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;count&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;:0&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;then
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# Create new record
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;curl&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -s -X&lt;&#x2F;span&gt;&lt;span&gt; POST &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;https:&#x2F;&#x2F;api.cloudflare.com&#x2F;client&#x2F;v4&#x2F;zones&#x2F;$&lt;&#x2F;span&gt;&lt;span&gt;{CLOUDFLARE_ZONE_ID}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&#x2F;dns_records&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;\
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;            -H &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;Authorization: Bearer $&lt;&#x2F;span&gt;&lt;span&gt;{CLOUDFLARE_API_TOKEN}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;\
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;            -H &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;Content-Type: application&#x2F;json&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;\
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;            --data &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;type&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;A&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;,
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;{preview_id}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;,
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;content&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;{server_ip}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;,
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;ttl&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;: 1,
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;proxied&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;: true
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;            }&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;else
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# Update existing record
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;local &lt;&#x2F;span&gt;&lt;span&gt;record_id&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;echo &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;$&lt;&#x2F;span&gt;&lt;span&gt;existing_record&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;grep&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -o &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;#39;&amp;quot;id&amp;quot;:&amp;quot;[^&amp;quot;]*&amp;#39; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;cut&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -d&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;#39;&amp;quot;&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -f4&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;curl&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -s -X&lt;&#x2F;span&gt;&lt;span&gt; PUT &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;https:&#x2F;&#x2F;api.cloudflare.com&#x2F;client&#x2F;v4&#x2F;zones&#x2F;$&lt;&#x2F;span&gt;&lt;span&gt;{CLOUDFLARE_ZONE_ID}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&#x2F;dns_records&#x2F;$&lt;&#x2F;span&gt;&lt;span&gt;{record_id}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;\
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;            -H &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;Authorization: Bearer $&lt;&#x2F;span&gt;&lt;span&gt;{CLOUDFLARE_API_TOKEN}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;\
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;            -H &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;Content-Type: application&#x2F;json&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;\
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;            --data &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;{
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;type&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;A&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;,
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;{preview_id}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;,
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;content&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;{server_ip}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;,
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;ttl&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;: 1,
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;                &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;proxied&lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;: true
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;            }&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;fi
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;We&#x27;ll need to pass some environment variables from our GitHub Actions:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;yml&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-yml &quot;&gt;&lt;code class=&quot;language-yml&quot; data-lang=&quot;yml&quot;&gt;&lt;span&gt;      - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;Deploy Preview
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;env&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;PREVIEW_ID&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;${{ steps.pr.outputs.PR_NUMBER }}
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;CLOUDFLARE_API_TOKEN&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;${{ secrets.CLOUDFLARE_API_TOKEN }}
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;CLOUDFLARE_ZONE_ID&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;${{ secrets.CLOUDFLARE_ZONE_ID }}
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;run&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;|
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;          chmod +x .&#x2F;scripts&#x2F;preview.sh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;          .&#x2F;scripts&#x2F;preview.sh
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;The Cloudflare &lt;a href=&quot;https:&#x2F;&#x2F;developers.cloudflare.com&#x2F;fundamentals&#x2F;api&#x2F;get-started&#x2F;create-token&#x2F;&quot;&gt;API token&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;developers.cloudflare.com&#x2F;fundamentals&#x2F;setup&#x2F;find-account-and-zone-ids&#x2F;&quot;&gt;Zone ID&lt;&#x2F;a&gt; should be stored as GitHub secrets.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;part-2-deploying-your-changes&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#part-2-deploying-your-changes&quot; aria-label=&quot;Anchor link for: part-2-deploying-your-changes&quot;&gt;Part 2: Deploying Your Changes&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;This part will vary depending on your stack, but the principle is the same: get your PR changes somewhere they can be served. I&#x27;ll show you my Zola setup, but you can adapt this for any framework.&lt;&#x2F;p&gt;
&lt;p&gt;In my case, Zola builds a &lt;code&gt;&#x2F;public&lt;&#x2F;code&gt; directory with all my static files. Your build process might look different:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;yml&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-yml &quot;&gt;&lt;code class=&quot;language-yml&quot; data-lang=&quot;yml&quot;&gt;&lt;span&gt;      - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;Build site
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;run&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;|
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;          # npm run build  # for Next.js&#x2F;React
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;          # yarn build     # for Gatsby
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;          # bundle exec jekyll build  # for Jekyll
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;          zola build      # my case
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Now we need to get these files to our server. Here&#x27;s a simple but effective approach using nothing other than good old scp:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;deploy_files&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;local &lt;&#x2F;span&gt;&lt;span&gt;preview_id&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;1
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# Ensure preview directory exists
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;ssh &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;$&lt;&#x2F;span&gt;&lt;span&gt;USER&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;@$&lt;&#x2F;span&gt;&lt;span&gt;HOST&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot; &amp;quot;sudo mkdir -p &#x2F;var&#x2F;www&#x2F;previews&#x2F;$&lt;&#x2F;span&gt;&lt;span&gt;{preview_id}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# Create temp directory for transfer
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;ssh &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;$&lt;&#x2F;span&gt;&lt;span&gt;USER&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;@$&lt;&#x2F;span&gt;&lt;span&gt;HOST&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot; &amp;quot;mkdir -p &#x2F;tmp&#x2F;$&lt;&#x2F;span&gt;&lt;span&gt;{preview_id}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# Copy built files
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;scp&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -r&lt;&#x2F;span&gt;&lt;span&gt; public&#x2F;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;* &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;$&lt;&#x2F;span&gt;&lt;span&gt;USER&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;@$&lt;&#x2F;span&gt;&lt;span&gt;HOST&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;:&#x2F;tmp&#x2F;$&lt;&#x2F;span&gt;&lt;span&gt;{preview_id}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&#x2F;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# Move files to final location
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;ssh &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;$&lt;&#x2F;span&gt;&lt;span&gt;USER&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;@$&lt;&#x2F;span&gt;&lt;span&gt;HOST&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot; &amp;quot;sudo rm -rf &#x2F;var&#x2F;www&#x2F;previews&#x2F;$&lt;&#x2F;span&gt;&lt;span&gt;{preview_id}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&#x2F;* &amp;amp;&amp;amp; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;                       sudo mv &#x2F;tmp&#x2F;$&lt;&#x2F;span&gt;&lt;span&gt;{preview_id}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&#x2F;* &#x2F;var&#x2F;www&#x2F;previews&#x2F;$&lt;&#x2F;span&gt;&lt;span&gt;{preview_id}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&#x2F; &amp;amp;&amp;amp; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#4cbf99;&quot;&gt;\
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;                       rm -rf &#x2F;tmp&#x2F;$&lt;&#x2F;span&gt;&lt;span&gt;{preview_id}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Add the SSH credentials to your GitHub Action:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;yml&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-yml &quot;&gt;&lt;code class=&quot;language-yml&quot; data-lang=&quot;yml&quot;&gt;&lt;span&gt;      - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;Deploy Preview
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;env&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;HOST&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;${{ secrets.SERVER_HOST }}
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;USER&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;${{ secrets.SERVER_USER }}
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;PREVIEW_ID&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;${{ steps.pr.outputs.PR_NUMBER }}
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;CLOUDFLARE_API_TOKEN&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;${{ secrets.CLOUDFLARE_API_TOKEN }}
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;CLOUDFLARE_ZONE_ID&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;${{ secrets.CLOUDFLARE_ZONE_ID }}
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;run&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;|
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;          chmod +x .&#x2F;scripts&#x2F;preview.sh
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;          .&#x2F;scripts&#x2F;preview.sh
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;part-3-web-server-configuration&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#part-3-web-server-configuration&quot; aria-label=&quot;Anchor link for: part-3-web-server-configuration&quot;&gt;Part 3: Web Server Configuration&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;The final piece is telling your web server about our new site. I&#x27;ll show you how to do this with different servers:&lt;&#x2F;p&gt;
&lt;p&gt;First, create a directory for our preview configs:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# On your server
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; mkdir&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -p&lt;&#x2F;span&gt;&lt;span&gt; &#x2F;etc&#x2F;caddy&#x2F;conf.d  &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# for Caddy
&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# or
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;sudo&lt;&#x2F;span&gt;&lt;span&gt; mkdir&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -p&lt;&#x2F;span&gt;&lt;span&gt; &#x2F;etc&#x2F;nginx&#x2F;sites-available  &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# for Nginx
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;For Caddy&lt;&#x2F;strong&gt; (my choice because it makes SSL super easy):
Add this to your main Caddyfile:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;Caddyfile&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-Caddyfile &quot;&gt;&lt;code class=&quot;language-Caddyfile&quot; data-lang=&quot;Caddyfile&quot;&gt;&lt;span&gt;import &#x2F;etc&#x2F;caddy&#x2F;conf.d&#x2F;*
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Then create preview configs like this:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;setup_caddy&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;local &lt;&#x2F;span&gt;&lt;span&gt;preview_id&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;$&lt;&#x2F;span&gt;&lt;span&gt;1
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;local &lt;&#x2F;span&gt;&lt;span&gt;config_content&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;$&lt;&#x2F;span&gt;&lt;span&gt;{preview_id}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;.yourdomain.com {
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;        root * &#x2F;var&#x2F;www&#x2F;previews&#x2F;$&lt;&#x2F;span&gt;&lt;span&gt;{preview_id}
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;        file_server
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;    }&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# Add&#x2F;update site configuration
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;echo &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;$&lt;&#x2F;span&gt;&lt;span&gt;config_content&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;ssh &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;$&lt;&#x2F;span&gt;&lt;span&gt;USER&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;@$&lt;&#x2F;span&gt;&lt;span&gt;HOST&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot; &amp;quot;sudo tee &#x2F;etc&#x2F;caddy&#x2F;conf.d&#x2F;$&lt;&#x2F;span&gt;&lt;span&gt;{preview_id}&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;.conf&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# Reload Caddy
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;ssh &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;$&lt;&#x2F;span&gt;&lt;span&gt;USER&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;@$&lt;&#x2F;span&gt;&lt;span&gt;HOST&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot; &amp;quot;sudo systemctl reload caddy&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;For Nginx&lt;&#x2F;strong&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;nginx&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-nginx &quot;&gt;&lt;code class=&quot;language-nginx&quot; data-lang=&quot;nginx&quot;&gt;&lt;span&gt;server {
&lt;&#x2F;span&gt;&lt;span&gt;    listen 80;
&lt;&#x2F;span&gt;&lt;span&gt;    server_name pr-123.yourdomain.com;
&lt;&#x2F;span&gt;&lt;span&gt;    root &#x2F;var&#x2F;www&#x2F;previews&#x2F;pr-123;
&lt;&#x2F;span&gt;&lt;span&gt;    
&lt;&#x2F;span&gt;&lt;span&gt;    location &#x2F; {
&lt;&#x2F;span&gt;&lt;span&gt;        try_files $uri $uri&#x2F; =404;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;For Apache&lt;&#x2F;strong&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;apache&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-apache &quot;&gt;&lt;code class=&quot;language-apache&quot; data-lang=&quot;apache&quot;&gt;&lt;span&gt;&amp;lt;VirtualHost *:80&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;    ServerName pr-123.yourdomain.com
&lt;&#x2F;span&gt;&lt;span&gt;    DocumentRoot &#x2F;var&#x2F;www&#x2F;previews&#x2F;pr-123
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;Directory &#x2F;var&#x2F;www&#x2F;previews&#x2F;pr-123&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;        Options Indexes FollowSymLinks
&lt;&#x2F;span&gt;&lt;span&gt;        AllowOverride None
&lt;&#x2F;span&gt;&lt;span&gt;        Require all granted
&lt;&#x2F;span&gt;&lt;span&gt;    &amp;lt;&#x2F;Directory&amp;gt;
&lt;&#x2F;span&gt;&lt;span&gt;&amp;lt;&#x2F;VirtualHost&amp;gt;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;putting-it-all-together&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#putting-it-all-together&quot; aria-label=&quot;Anchor link for: putting-it-all-together&quot;&gt;Putting It All Together&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;Our complete &lt;code&gt;preview.sh&lt;&#x2F;code&gt; script looks like this:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;#!&#x2F;bin&#x2F;bash
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;setup_dns&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# DNS setup function from above
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;deploy_files&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# File deployment function from above
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;setup_webserver&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# Web server config function from above
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;main&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;setup_dns &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;$&lt;&#x2F;span&gt;&lt;span&gt;PREVIEW_ID&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;deploy_files &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;$&lt;&#x2F;span&gt;&lt;span&gt;PREVIEW_ID&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;setup_webserver &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;$&lt;&#x2F;span&gt;&lt;span&gt;PREVIEW_ID&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;main
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h1 id=&quot;cleanup&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#cleanup&quot; aria-label=&quot;Anchor link for: cleanup&quot;&gt;Cleanup&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;One thing we haven&#x27;t addressed is cleanup. When a PR is closed, we need to:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Remove the DNS record&lt;&#x2F;li&gt;
&lt;li&gt;Delete the preview files&lt;&#x2F;li&gt;
&lt;li&gt;Remove the web server config&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;Create a new GitHub workflow for this:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;yml&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-yml &quot;&gt;&lt;code class=&quot;language-yml&quot; data-lang=&quot;yml&quot;&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;Cleanup PR Preview
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;on&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;pull_request&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;types&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;closed&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;jobs&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;cleanup&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;runs-on&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;ubuntu-latest
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;steps&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;      - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;uses&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;actions&#x2F;checkout@v3
&lt;&#x2F;span&gt;&lt;span&gt;      
&lt;&#x2F;span&gt;&lt;span&gt;      - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;Cleanup
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;env&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;PREVIEW_ID&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;pr-${{ github.event.pull_request.number }}
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# Add other environment variables
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;run&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;.&#x2F;scripts&#x2F;cleanup.sh
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;The complete cleanup scripts are available in my repo:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rupert648&#x2F;pert.dev&#x2F;blob&#x2F;main&#x2F;.github&#x2F;workflows&#x2F;cleanup-preview.yml&quot;&gt;Cleanup Workflow&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rupert648&#x2F;pert.dev&#x2F;blob&#x2F;main&#x2F;scripts&#x2F;cleanup-preview.sh&quot;&gt;Cleanup Script&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;conclusion&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#conclusion&quot; aria-label=&quot;Anchor link for: conclusion&quot;&gt;Conclusion&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;So there you have it! While fancy deployment platforms give you this for free, building your own preview system isn&#x27;t as daunting as it might seem. With some basic systems knowledge and a few hours of work, you can have your own preview deployment system that:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Costs nothing extra if you&#x27;re already self-hosting&lt;&#x2F;li&gt;
&lt;li&gt;Gives you complete control over the setup&lt;&#x2F;li&gt;
&lt;li&gt;Helps you understand what&#x27;s actually happening under the hood&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Want to see the complete implementation? Check out:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rupert648&#x2F;pert.dev&#x2F;blob&#x2F;main&#x2F;.github&#x2F;workflows&#x2F;pr-preview.yml&quot;&gt;PR Preview Workflow&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rupert648&#x2F;pert.dev&#x2F;blob&#x2F;main&#x2F;scripts&#x2F;preview.sh&quot;&gt;PR Preview Script&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rupert648&#x2F;pert.dev&#x2F;blob&#x2F;main&#x2F;.github&#x2F;workflows&#x2F;cleanup-preview.yml&quot;&gt;Cleanup Workflow&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;rupert648&#x2F;pert.dev&#x2F;blob&#x2F;main&#x2F;scripts&#x2F;cleanup-preview.sh&quot;&gt;Cleanup Script&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>How a Global HashMap in AWS Lambda Made Our App Speak in Tongues</title>
        <published>2024-12-26T00:00:00+00:00</published>
        <updated>2024-12-26T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://pert.dev/posts/aws-lambda-hashmap-bug/"/>
        <id>https://pert.dev/posts/aws-lambda-hashmap-bug/</id>
        
        <content type="html" xml:base="https://pert.dev/posts/aws-lambda-hashmap-bug/">&lt;h2 id=&quot;background&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#background&quot; aria-label=&quot;Anchor link for: background&quot;&gt;Background&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;Before I joined Cloudflare I was working on a GraphQL service aggregating and untangling the spaghetti of data we received from the herd of microservices which kept NowTV (Sky&#x27;s streaming service in the UK), Peacock (NBCUniversal&#x27;s streaming platform), and SkyShowtime (a European streaming service) alive. At the time this was an entirely serverless service, built on &lt;a href=&quot;https:&#x2F;&#x2F;aws.amazon.com&#x2F;lambda&#x2F;&quot;&gt;AWS lambda serverless&lt;&#x2F;a&gt; compute - a decision we would come to regret for a whole host of headaches and footguns, one of which I will try my best to detail in this post. Whilst I&#x27;d had some experience delivering some hobby projects onto various serverless compute platforms, this was my first time using them to deliver anything bigger than a university project. I and this team just so happened to be maintaining a not so insignificant service handling upwards of 3 million requests a day, across multiple regions, services and a disturbingly dynamic traffic pattern.&lt;&#x2F;p&gt;
&lt;p&gt;One of the first things you will learn about serverless platforms, is that most (most because &lt;a href=&quot;https:&#x2F;&#x2F;blog.cloudflare.com&#x2F;eliminating-cold-starts-with-cloudflare-workers&#x2F;&quot;&gt;not Cloudflare workers!&lt;&#x2F;a&gt;) experience something called cold starts. Cold starts occur when a new instance of your Lambda function needs to be initialized from scratch. This happens in a few key scenarios; The most obvious case is when your function hasn&#x27;t been invoked for a while (and by &quot;a while&quot; I mean as little as 15 minutes in some cases), AWS helpfully decides to tear down your execution environment. The next request that comes in has to wait for the entire container to spin up, your code to be loaded, and any initialization code to run.&lt;&#x2F;p&gt;
&lt;p&gt;But here&#x27;s where it gets interesting, especially in the JavaScript world - subsequent invocations are lightning fast because the V8 engine keeps your code warm and ready. This is what AWS calls a &quot;warm start&quot;, and it&#x27;s your best friend when dealing with high-traffic services. The execution environment stays alive, your database connections remain established, and any expensive initialization code only needs to run once.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-bug-emerges&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-bug-emerges&quot; aria-label=&quot;Anchor link for: the-bug-emerges&quot;&gt;The Bug Emerges&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;Around February 2023, one lovely cold British morning in West London various users in the UK reported that their profile page heading texts were coming back in Italian - on our English site. Hmm. Strange, maybe a caching issue in our CDN? It didn&#x27;t seem to last for long so we moved on. Later that day, we got a message from one of our German SkyShowtime customers, reporting that their account settings page was coming back in Polish - very odd. And by the time a Spanish customer was reporting that their checkout page was in Portuguese (which I&#x27;m sure was extremely upsetting), we knew something was afoot.&lt;&#x2F;p&gt;
&lt;p&gt;Immediately like all good engineers we blamed another team. This time it was the content database team, who were responsible for the CMS which returned the various tags, labels and similar page content which we were seeing mistranslated. The desired location and language of those tags were passed from the front end, through our service and forwarded to this CMS service via headers; based on these headers the correct language content was returned. Here&#x27;s how the request flow should have worked:&lt;&#x2F;p&gt;
&lt;pre class=&quot;mermaid&quot;&gt;
  sequenceDiagram
    participant Browser
    participant FrontEnd as Frontend App
    participant Lambda as GraphQL Lambda
    participant CMS as Content CMS

    Browser-&gt;&gt;FrontEnd: User visits site
    Note over FrontEnd: Detects user locale
    FrontEnd-&gt;&gt;Lambda: GraphQL Query&lt;br&#x2F;&gt;X-Company-Language: fr-FR
    Lambda-&gt;&gt;CMS: GET &#x2F;content&lt;br&#x2F;&gt;X-Company-Language: fr-FR
    CMS--&gt;&gt;Lambda: {firstname: &quot;Prnom&quot;}
    Lambda--&gt;&gt;FrontEnd: Return localized content
    FrontEnd--&gt;&gt;Browser: Display in French
&lt;&#x2F;pre&gt;
&lt;p&gt;Our delegation efforts were quickly thwarted however, when we hit the production CMS directly and saw that it was consistently returning exactly the content it should be - damn.&lt;&#x2F;p&gt;
&lt;p&gt;So two more points of possible failure:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Frontend is somehow sending the wrong language&#x2F;location headers&lt;&#x2F;li&gt;
&lt;li&gt;Our GraphQL Middleware Layer is incorrect&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;Seeing as it was our job, we investigated our layer - and started where any experienced engineer would at the commits which had been added to the codebase since the last release, after which when the bug began to occur.&lt;&#x2F;p&gt;
&lt;p&gt;This is where we saw the innocuous commit titled something along the lines of &quot;optimised n+1 problem for tag fetching from cms&quot;, authored by yours truly.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-n-1-problem&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-n-1-problem&quot; aria-label=&quot;Anchor link for: the-n-1-problem&quot;&gt;The N+1 Problem&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;If you&#x27;re not familiar with the N+1 problem, I will give you a very brief explanation specific to GraphQL. Let&#x27;s say you have a query that asks for a list of checkout pages and their various text tags. Your resolver might look something like this:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span&gt;resolvers &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;  Query&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;checkoutPages&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;fetchAllCheckoutPages&lt;&#x2F;span&gt;&lt;span&gt;()&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;  }&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;  CheckoutPage&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;tags&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;page&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;fetchTagsForPage&lt;&#x2F;span&gt;&lt;span&gt;(page&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span&gt;id)
&lt;&#x2F;span&gt;&lt;span&gt;  }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Seems innocent enough right? Well when you query this:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;graphql&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-graphql &quot;&gt;&lt;code class=&quot;language-graphql&quot; data-lang=&quot;graphql&quot;&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;query &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;checkoutPages &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;id
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;tags &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;text
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;language
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;  }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;What actually happens is your resolver first fetches all the checkout pages (1 query), and then for each page it makes a separate query to fetch its tags (n queries) - hence the term &quot;N+1&quot;. So if you have 100 checkout pages, you&#x27;re suddenly making 101 database calls: the initial query plus one additional query per page.&lt;&#x2F;p&gt;
&lt;p&gt;To solve this, you can &quot;hoist&quot; (that overloaded term again) the +1 calls, in the above example the tags calls, to be all called in one big query in the checkoutPages resolver:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;javascript&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-javascript &quot;&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;interface &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;Page &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;  id&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;string&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  tags&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;Tag&lt;&#x2F;span&gt;&lt;span&gt;[]&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;interface &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;Tag &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;  id&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;string&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  pageId&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;string&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  text&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;string&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;  language&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;string&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;&#x2F;&#x2F; Before hoisting - N+1 problem
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span&gt;resolvers &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;  Query&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;checkoutPages&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;fetchAllCheckoutPages&lt;&#x2F;span&gt;&lt;span&gt;()
&lt;&#x2F;span&gt;&lt;span&gt;  }&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;  CheckoutPage&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;tags&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;page&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;fetchTagsForPage&lt;&#x2F;span&gt;&lt;span&gt;(page&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span&gt;id)
&lt;&#x2F;span&gt;&lt;span&gt;  }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;&#x2F;&#x2F; After hoisting - Single query with tags included
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span&gt;resolvers &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;  Query&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;checkoutPages&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;async &lt;&#x2F;span&gt;&lt;span&gt;() &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span&gt;pages &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;await &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;fetchAllCheckoutPages&lt;&#x2F;span&gt;&lt;span&gt;()&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span&gt;pageIds &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span&gt;pages&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;page &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;page&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span&gt;id)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;      
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;&#x2F;&#x2F; Fetch ALL tags for ALL pages in one query 
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;&#x2F;&#x2F; (or this could just be combined into one query above)
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;const &lt;&#x2F;span&gt;&lt;span&gt;allTags &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;await &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;fetchTagsForPages&lt;&#x2F;span&gt;&lt;span&gt;(pageIds)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;      
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;&#x2F;&#x2F; Return pages with their tags already attached
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span&gt;pages&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;page &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;({
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;...&lt;&#x2F;span&gt;&lt;span&gt;page&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;,
&lt;&#x2F;span&gt;&lt;span&gt;        tags&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;allTags&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;filter&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;tag &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;=&amp;gt; &lt;&#x2F;span&gt;&lt;span&gt;tag&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span&gt;pageId &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;=== &lt;&#x2F;span&gt;&lt;span&gt;page&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span&gt;id)
&lt;&#x2F;span&gt;&lt;span&gt;      }))&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;&#x2F;&#x2F; Now GraphQL will automatically resolve the tags field
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;&#x2F;&#x2F; since it&amp;#39;s already included in the returned object
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;  }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Then we just remove the tags resolver and let our GraphQL lib automatically fill out the values since they already exist in the returning object. Hence we are only making one database call rather than N+1.&lt;&#x2F;p&gt;
&lt;p&gt;However, in our case, we were also resolving a subset of those tags in another part of the schema, with another resolver. Whilst we implemented memoization and caching at our data fetcher layer, meaning identical http calls would save the response and just re-use the value up to a TTL, since we weren&#x27;t requesting ALL the same tags, the call we were making to the CMS would be different, and therefore would require another roundtrip even though we already had the data saved in another part of the codebase.&lt;&#x2F;p&gt;
&lt;p&gt;Haha... I thought to myself, I have an easy solution, another in-mem cache! We&#x27;ll just use a hashmap, store each value by its tag name, and boom, before making subsequent calls to the CMS we&#x27;ll just check this HashMap for the value and return this early. This worked great! I halved the number of calls to this CMS and got a pat on the back. Nice.&lt;&#x2F;p&gt;
&lt;p&gt;However, my mind had been ruined from months of working under the &quot;single request single lifetime&quot; type of programming which some of you might also have been sucked into whilst working in a serverless environment, and so carelessly put this hashmap globally, rather than attaching it to the context of the request. Silly me.&lt;&#x2F;p&gt;
&lt;p&gt;As I said, the cache key into this HashMap was just the label of the content requested from the CMS. But to make life easy, the label was the same between languages, only content differed based on the aforementioned headers. So you can probably see where this was going...&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-bug&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-bug&quot; aria-label=&quot;Anchor link for: the-bug&quot;&gt;The Bug&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;This global hashmap was &quot;surviving&quot; between requests, and this is where AWS Lambda&#x27;s warm start behavior came back to bite us. Let me break down exactly what was happening:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Lambda Instance A spins up (cold start)&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Global hashmap is initialized (empty)&lt;&#x2F;li&gt;
&lt;li&gt;Memory space is allocated just for this instance&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Request #1 comes in from the UK:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Header: &lt;code&gt;X-Company-Language: en-GB&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Looks for &quot;firstname-input-label&quot; in hashmap&lt;&#x2F;li&gt;
&lt;li&gt;Not found, fetches from CMS: &quot;First Name&quot;&lt;&#x2F;li&gt;
&lt;li&gt;Stores in global hashmap: &lt;code&gt;{&quot;firstname-input-label&quot;: &quot;First Name&quot;}&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;li&gt;
&lt;p&gt;Request #2 arrives at the &lt;em&gt;same&lt;&#x2F;em&gt; Lambda instance:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Header: &lt;code&gt;X-Company-Language: fr-FR&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;Looks for &quot;firstname-input-label&quot; in hashmap&lt;&#x2F;li&gt;
&lt;li&gt;Found! Returns &quot;First Name&quot; instead of fetching &quot;Prnom&quot; from CMS&lt;&#x2F;li&gt;
&lt;li&gt;French user sees English text &lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;What made this particularly sneaky was that it would only happen when:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;The Lambda instance was warm (cold starts would reset the hashmap)&lt;&#x2F;li&gt;
&lt;li&gt;Two requests for the same content in different languages hit the same instance&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;This created a fascinating pattern where users would see incorrect translations in seemingly random bursts, coinciding with warm Lambda instances serving requests across different regions and languages. The more traffic we had, the more instances were kept warm, and the more likely users were to hit this issue.&lt;&#x2F;p&gt;
&lt;p&gt;Ironically, our standard monitoring tools didn&#x27;t catch this initially because they were focused on traditional metrics like error rates and response times - both of which remained perfectly normal. The issue only became apparent through user reports, highlighting a gap in our observability: we weren&#x27;t monitoring for content correctness across languages.&lt;&#x2F;p&gt;
&lt;p&gt;The fix was easy, instantiate the hashmap on the request context, and, just to be extra safe, include the language in the key.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-lessons-learned&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-lessons-learned&quot; aria-label=&quot;Anchor link for: the-lessons-learned&quot;&gt;The Lessons Learned&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;The multi-region, multi-language architecture being served by a single Lambda instance turned out to be a fundamental design flaw. While it seemed efficient at first, this approach violated the principle of separation of concerns and created an unnecessary coupling between different locales. A better approach would have been to separate these concerns, perhaps using different Lambda functions for different regions or implementing proper language-based routing.&lt;&#x2F;p&gt;
&lt;p&gt;The specific layout of our GraphQL schema that led to the N+1 problem was another key lesson. While optimizing query performance is important, it&#x27;s crucial to consider how these optimizations might interact with stateful operations. This highlights the importance of designing schemas with not just performance but also maintainability and isolation in mind.&lt;&#x2F;p&gt;
&lt;p&gt;Our testing strategy had clear gaps - particularly around multi-language scenarios and warm Lambda behavior. Traditional unit tests and integration tests weren&#x27;t enough to catch this issue. We should have implemented more comprehensive fuzz testing, especially focusing on locale-specific edge cases and state persistence between requests. Furthermore, load testing across different regions with varying language settings could have surfaced this issue before it reached production.&lt;&#x2F;p&gt;
&lt;p&gt;At its core, this bug emerged from forgetting a fundamental principle: serverless functions, despite their persistent warm states, should treat each request as isolated. The &quot;single HTTP call, single function&quot; mentality of serverless made it easy to overlook the implications of global state, but that doesn&#x27;t excuse me making the silly mistake of violating the stateless nature of HTTP services.&lt;&#x2F;p&gt;
&lt;p&gt;Let it be a lesson to folks. &lt;strong&gt;HTTP IS STATELESS! INCLUDING GRAPHQL!&lt;&#x2F;strong&gt; Don&#x27;t put anything global, unless you know it can truly be reused between requests.&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Implementing a HashMap in Rust</title>
        <published>2023-01-04T00:00:00+00:00</published>
        <updated>2023-01-04T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://pert.dev/posts/rust-hashmap/"/>
        <id>https://pert.dev/posts/rust-hashmap/</id>
        
        <content type="html" xml:base="https://pert.dev/posts/rust-hashmap/">&lt;p&gt;In this tutorial, we&#x27;re going to help you build your very own HashMap in Rust. We&#x27;ll be explaining each step along the way, so don&#x27;t worry if you&#x27;re new to the language. However, some basic knowledge of Rust is expected for this tutorial  we won&#x27;t be covering concepts like mutable references or Rust syntax in detail.&lt;&#x2F;p&gt;
&lt;p&gt;If you want to skip past the tutorial and step-by-step explanations, feel free to jump straight to the project on GitHub. This project also includes some unit tests which, for brevity&#x27;s sake, I have skipped past adding in this tutorial.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;understanding-hashmaps&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#understanding-hashmaps&quot; aria-label=&quot;Anchor link for: understanding-hashmaps&quot;&gt;Understanding Hashmaps&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;Let&#x27;s begin with arrays, and why they&#x27;re great. An array is a collection of data stored in sequential order. Each data element in the array is assigned a numerical index, which can be used to access and retrieve the element.&lt;&#x2F;p&gt;
&lt;p&gt;For example, if we want to retrieve a specific piece of data from an array and we know its index, we can easily use that index to access the element at that position in the array. The array provides a starting point or &quot;pointer&quot; for the series of data, and the index tells us how far to move from that starting point to access the desired element.&lt;&#x2F;p&gt;
&lt;p&gt;One limitation of using arrays to store data is that we must know the index of the element to access it. This can be inconvenient if we only know the value of the element itself or if we want to use a different type of information, such as a key, to access the element.&lt;&#x2F;p&gt;
&lt;p&gt;In these cases, a hashmap can be a more suitable data structure. A hashmap is a collection of data that is stored and accessed using keys rather than indices. This allows us to retrieve elements based on their associated key rather than their position in the collection.&lt;&#x2F;p&gt;
&lt;p&gt;For example, we could use a person&#x27;s name as a key to access their phone number in a hashmap. Hashmaps offer more flexibility and power when it comes to storing and accessing data compared to arrays.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;how-does-it-work&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#how-does-it-work&quot; aria-label=&quot;Anchor link for: how-does-it-work&quot;&gt;How Does It Work?&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;At their underlying structure, a hashmap is, in essence, an array. However, we are now changing the method of accessing that array. This is where a hash function comes in. A hash function takes a key as input and returns some integer which we can use as an index into that underlying array.&lt;&#x2F;p&gt;
&lt;p&gt;A simple hash function for converting a string into an integer may look as follows in rust:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;fn &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;simple_hash&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;string&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;amp;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;str&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;-&amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;u32 &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;let mut&lt;&#x2F;span&gt;&lt;span&gt; total &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;for&lt;&#x2F;span&gt;&lt;span&gt; c &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;in&lt;&#x2F;span&gt;&lt;span&gt; string&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;chars&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        total &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;+=&lt;&#x2F;span&gt;&lt;span&gt; c &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;u32&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;    total
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Once we have the integer value returned by the hash function, we can use the modulus operator to reduce it to a value within the bounds of the array. For example:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;rust&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-rust &quot;&gt;&lt;code class=&quot;language-rust&quot; data-lang=&quot;rust&quot;&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;let&lt;&#x2F;span&gt;&lt;span&gt; index &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f07171;&quot;&gt;simple_hash&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;hello&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;) &lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;%&lt;&#x2F;span&gt;&lt;span&gt; array_size&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This would give us an index within the bounds of the array, allowing us to access the element at that index using the key &quot;hello&quot;.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;properties-of-a-perfect-hash-function&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#properties-of-a-perfect-hash-function&quot; aria-label=&quot;Anchor link for: properties-of-a-perfect-hash-function&quot;&gt;Properties of a &quot;Perfect&quot; Hash Function&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;A &quot;perfect&quot; or &quot;ideal&quot; hash function would have the following properties:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;It should be deterministic, meaning that it always produces the same output for a given input&lt;&#x2F;li&gt;
&lt;li&gt;It should distribute keys uniformly across the range of possible output values so that keys are evenly distributed among the indices in the underlying array&lt;&#x2F;li&gt;
&lt;li&gt;It should produce a unique output value for every possible key so that there are no collisions&lt;&#x2F;li&gt;
&lt;li&gt;It should be fast to compute so that it does not significantly impact the performance of the hashmap&lt;&#x2F;li&gt;
&lt;li&gt;It should be resistant to collision attacks, meaning that it should be difficult for an attacker to craft keys that will produce collisions&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Keep in mind that it is generally impossible to achieve all of these properties at the same time, especially when dealing with large sets of keys. Therefore, most hash functions aim to balance these properties and trade off some degree of performance or security to achieve a reasonable level of effectiveness.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;handling-collisions&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#handling-collisions&quot; aria-label=&quot;Anchor link for: handling-collisions&quot;&gt;Handling Collisions&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;The truth is, collisions are inevitable when working with hashmaps. Either the hash function produces the same index for two values, or the underlying array is smaller than the number of values it holds. Either way at some point two or more keys may be pointing at the same location in memory, and we want to avoid any unwritten data.&lt;&#x2F;p&gt;
&lt;p&gt;A common solution to this, and the solution we will be using, is to create a linked list at each index in the array when a collision occurs. Then, when searching for a key&#x2F;value, we traverse this linked list until we find our key.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;implementing-the-hashmap&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#implementing-the-hashmap&quot; aria-label=&quot;Anchor link for: implementing-the-hashmap&quot;&gt;Implementing the HashMap&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;For our tutorial, we are going to be implementing the four most basic operations of a hashmap:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;HashMap&amp;lt;T, V&amp;gt;.get(key: T)&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;HashMap&amp;lt;T, V&amp;gt;.push(key: T, value: V)&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;HashMap&amp;lt;T, V&amp;gt;.delete(key: T)&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;code&gt;HashMap&amp;lt;T, V&amp;gt;.clear()&lt;&#x2F;code&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Note that we can see type annotations here, which allows our implementation to be fully generic and accept any type (with some caveats) for our key and value pair.&lt;&#x2F;p&gt;
&lt;p&gt;[Content continues with all code blocks preserved...]&lt;&#x2F;p&gt;
&lt;h1 id=&quot;conclusion&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#conclusion&quot; aria-label=&quot;Anchor link for: conclusion&quot;&gt;Conclusion&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;Congrats on making it through this tutorial on implementing a hashmap in Rust! By now, you should have a good understanding of how hashmaps work and how to implement one from scratch. You should also be familiar with one possible implementation of the various methods that a hashmap provides, such as put, get, and remove.&lt;&#x2F;p&gt;
&lt;p&gt;I hope that you found this tutorial helpful and that it has given you the confidence to implement a hashMap in your own Rust projects. Feel free to play around with the code and try out different configurations and methods to get a better understanding of how it all works.&lt;&#x2F;p&gt;
&lt;p&gt;You can also check out the fully completed code for this tutorial on the GitHub repository here, complete with a few unit tests for the code.&lt;&#x2F;p&gt;
&lt;p&gt;Thanks for reading, and happy coding!&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Deploying an Argo Workflow on GKE and accessing the Argo UI</title>
        <published>2022-12-07T00:00:00+00:00</published>
        <updated>2022-12-07T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://pert.dev/posts/deploying-argo-on-gke/"/>
        <id>https://pert.dev/posts/deploying-argo-on-gke/</id>
        
        <content type="html" xml:base="https://pert.dev/posts/deploying-argo-on-gke/">&lt;p&gt;Alright, to begin this work through assumes a baseline knowledge of a few things; argo and how a basic workflow is configured, a basic understanding of docker and kubernetes, and some familiarity with Google Cloud.&lt;&#x2F;p&gt;
&lt;p&gt;Before doing this, I would try and get a workflow up and running locally through minikube. To do this you can follow the official argo getting started &lt;a href=&quot;https:&#x2F;&#x2F;argoproj.github.io&#x2F;argo-workflows&#x2F;quick-start&#x2F;&quot;&gt;here&lt;&#x2F;a&gt;. Through that it should just be a few minutes until you&#x27;ve successfully ran your first workflow.&lt;&#x2F;p&gt;
&lt;p&gt;However, something simple locally is almost never something simple on the cloud. The first time getting a workflow up and running on GKE I had to jump through a number of hoops to do so, so hopefully this tutorial can speed that process up a bit for yourselves.&lt;&#x2F;p&gt;
&lt;p&gt;We have a few goals we want to accomplish in this tutorial:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Install Argo onto a Kubernetes cluster hosted on GKE&lt;&#x2F;li&gt;
&lt;li&gt;Gain access to the Argo UI&lt;&#x2F;li&gt;
&lt;li&gt;Deploy a basic workflow&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h1 id=&quot;the-workflow&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-workflow&quot; aria-label=&quot;Anchor link for: the-workflow&quot;&gt;The Workflow&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;To keep it simple, we will be deploying the following basic workflow, taken from the getting-started page of the argo workflows site.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;yaml&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-yaml &quot;&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;apiVersion&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;argoproj.io&#x2F;v1alpha1  
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;kind&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;Workflow  
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;metadata&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:  
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;generateName&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;hello-world-  
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;labels&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:  
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;workflows.argoproj.io&#x2F;archive-strategy&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;false&amp;quot;  
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;spec&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:  
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;entrypoint&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;whalesay  
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;templates&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:  
&lt;&#x2F;span&gt;&lt;span&gt;  - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;whalesay  
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;container&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:  
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;image&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;docker&#x2F;whalesay:latest  
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;command&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;cowsay&lt;&#x2F;span&gt;&lt;span&gt;]  
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;args&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;hello world&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;We can put this into a file called &lt;code&gt;hello-world.yaml&lt;&#x2F;code&gt; to use later.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;installing-argo-onto-gke&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#installing-argo-onto-gke&quot; aria-label=&quot;Anchor link for: installing-argo-onto-gke&quot;&gt;Installing Argo onto GKE&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;creating-a-cluster&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#creating-a-cluster&quot; aria-label=&quot;Anchor link for: creating-a-cluster&quot;&gt;Creating a Cluster&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;I am going to start this tutorial from scratch, assuming that you don&#x27;t have a cluster created. But I will assume you have both the &lt;code&gt;gcloud&lt;&#x2F;code&gt; and &lt;code&gt;kubectl&lt;&#x2F;code&gt; CLIs installed. If not you can find them &lt;a href=&quot;https:&#x2F;&#x2F;cloud.google.com&#x2F;sdk&#x2F;docs&#x2F;install&quot;&gt;here&lt;&#x2F;a&gt; and &lt;a href=&quot;https:&#x2F;&#x2F;kubernetes.io&#x2F;docs&#x2F;tasks&#x2F;tools&#x2F;&quot;&gt;here&lt;&#x2F;a&gt; respectively.&lt;&#x2F;p&gt;
&lt;p&gt;To create a cluster, choose a name and run the following command:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;gcloud&lt;&#x2F;span&gt;&lt;span&gt; container clusters create CLUSTER_NAME&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; --image-type&lt;&#x2F;span&gt;&lt;span&gt; cos
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;IMPORTANT NOTE:&lt;&#x2F;strong&gt; you can specify that you want a cluster to be private with the option &lt;code&gt;--enable-private-nodes&lt;&#x2F;code&gt;. This will have an impact on the install method. See the section &lt;em&gt;Installing Argo onto a private cluster.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Now, configure your local &lt;code&gt;kubectl&lt;&#x2F;code&gt; to point to the new cluster:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;gcloud&lt;&#x2F;span&gt;&lt;span&gt; container clusters get-credentials CLUSTER_NAME
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;[Content continues with all code blocks, images, and formatting preserved...]&lt;&#x2F;p&gt;
&lt;h1 id=&quot;viewing-the-ui&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#viewing-the-ui&quot; aria-label=&quot;Anchor link for: viewing-the-ui&quot;&gt;Viewing the UI&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;You should be all setup! Run the following to see the IP address that your ingress is exposed on:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;kubectl&lt;&#x2F;span&gt;&lt;span&gt; get ingresses&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -n&lt;&#x2F;span&gt;&lt;span&gt; argo
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Then navigate in your browser to the address&#x2F;argo.&lt;&#x2F;p&gt;
&lt;p&gt;Hopefully you have success!&lt;&#x2F;p&gt;
&lt;p&gt;The combination of all these small interlinked things on gcloud made setting this up take much longer than it perhaps should have, so hopefully this tutorial made your life slightly easier. &lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Dynamically Scaling a Workflow Step in Argo Workflows</title>
        <published>2022-11-05T00:00:00+00:00</published>
        <updated>2022-11-05T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://pert.dev/posts/dynamic-argo-workflow/"/>
        <id>https://pert.dev/posts/dynamic-argo-workflow/</id>
        
        <content type="html" xml:base="https://pert.dev/posts/dynamic-argo-workflow/">&lt;h1 id=&quot;what-is-argo&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#what-is-argo&quot; aria-label=&quot;Anchor link for: what-is-argo&quot;&gt;What is Argo&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;From the Argo Site:&lt;&#x2F;p&gt;
&lt;blockquote&gt;
&lt;p&gt;Argo Workflows is an open source container-native workflow engine for orchestrating parallel jobs on Kubernetes&lt;&#x2F;p&gt;
&lt;&#x2F;blockquote&gt;
&lt;p&gt;Argo workflows allows you to define through a configuration file a series of steps to run inside a kubernetes cluster. Argo from this configuration will control the sequencing for this as well as orchestrating any parallel operations you define.&lt;&#x2F;p&gt;
&lt;p&gt;When managing many parallel running workflows, argo does all the leg work for you. It will spin up containers to handle the steps you define using the kubernetes API. However this wasn&#x27;t what I wanted.&lt;&#x2F;p&gt;
&lt;p&gt;The use case I wanted to achieve for was to dynamically scale a &lt;em&gt;&lt;strong&gt;single&lt;&#x2F;strong&gt;&lt;&#x2F;em&gt; &lt;em&gt;&lt;strong&gt;step&lt;&#x2F;strong&gt;&lt;&#x2F;em&gt; in a workflow, whilst keeping other steps static.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;why-did-i-need-this-use-case&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#why-did-i-need-this-use-case&quot; aria-label=&quot;Anchor link for: why-did-i-need-this-use-case&quot;&gt;Why did I need this Use Case?&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;A simplification of my use case provided just two steps:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;A data generation step, which puts the data into a shared database&lt;&#x2F;li&gt;
&lt;li&gt;A data pulling step, which pulls the data from the database and performs some processing on the data, before dumping it to a storage solution.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;p&gt;I wanted the data being generated in the first stage to consistently be unique whilst running the node. There are fancy ways to do this whilst running multiple containers but the simplest way to ensure unique data is to just have a single node generating the data.&lt;&#x2F;p&gt;
&lt;p&gt;The second step is what I wanted to scale  I want to make a decision based upon how much data is generated from the first step to decide how many instances of the second step I created. This would allow me to process the data in parallel. This would make the data processing step much quicker.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;em&gt;Note: A better solution to this issue might be to extract the data production from the workflow, however keeping it inside the workflow itself allowed expandability within my use case as well as the ability to extremely easily orchestrate the whole thing on a CRON job.&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;
&lt;h1 id=&quot;installation&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#installation&quot; aria-label=&quot;Anchor link for: installation&quot;&gt;Installation&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;To preface the solution, to demo these steps I am running these steps in a local cluster using &lt;a href=&quot;https:&#x2F;&#x2F;minikube.sigs.k8s.io&#x2F;docs&#x2F;start&#x2F;&quot;&gt;Minikube&lt;&#x2F;a&gt;. To install minikube follow the instructions on their site, or using homebrew:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;brew&lt;&#x2F;span&gt;&lt;span&gt; install minikube
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Run minikube start to spin up your minikube instance, then run the following to install argo:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;kubectl&lt;&#x2F;span&gt;&lt;span&gt; create namespace argo
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;kubectl&lt;&#x2F;span&gt;&lt;span&gt; apply&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -n&lt;&#x2F;span&gt;&lt;span&gt; argo&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -f&lt;&#x2F;span&gt;&lt;span&gt; https:&#x2F;&#x2F;github.com&#x2F;argoproj&#x2F;argo-workflows&#x2F;releases&#x2F;download&#x2F;v&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;lt;&amp;lt;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;ARGO_WORKFLOWS_VERSION&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;&amp;gt;&amp;gt;&lt;&#x2F;span&gt;&lt;span&gt;&#x2F;install.yaml
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;For the writing of this tutorial, I am using &lt;strong&gt;v3.4.2&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;You will also need to install the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;argoproj&#x2F;argo-workflows&#x2F;releases&#x2F;tag&#x2F;v3.4.3&quot;&gt;Argo CLI&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
&lt;h1 id=&quot;the-solution&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-solution&quot; aria-label=&quot;Anchor link for: the-solution&quot;&gt;The Solution&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;The solution to this problem I found was to utilise the output parameters you are able to pass through the steps in Argo Workflows. We can use these in conjunction with the withParam attribute to run parallel jobs.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;output-parameters&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#output-parameters&quot; aria-label=&quot;Anchor link for: output-parameters&quot;&gt;Output Parameters&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;Argo provides several forms of functionality for passing output parameters between steps:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Reading the standard output of a container&#x2F;script&lt;&#x2F;li&gt;
&lt;li&gt;Taking the value from a specified file&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Reading the standard output is okay for simple scripts, however since many programs will involve regular std output such as logging this may conflict and cause issues, hence creating a temp file to write the value is the easier route. Argo provides in their docs an example on how to do this:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;yaml&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-yaml &quot;&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;apiVersion&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;argoproj.io&#x2F;v1alpha1
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;kind&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;Workflow
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;metadata&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;generateName&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;output-parameter-
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;spec&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;entrypoint&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;output-parameter
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;templates&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;  - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;output-parameter
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;steps&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;    - - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;generate-parameter
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;template&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;whalesay
&lt;&#x2F;span&gt;&lt;span&gt;    - - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;consume-parameter
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;template&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;print-message
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;arguments&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;parameters&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;          - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;message
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;{{steps.generate-parameter.outputs.parameters.hello-param}}&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;whalesay
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;container&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;image&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;docker&#x2F;whalesay:latest
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;command&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;sh&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;-c&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;args&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;sleep 1; echo -n hello world &amp;gt; &#x2F;tmp&#x2F;hello_world.txt&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;outputs&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;parameters&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;      - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;hello-param
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;valueFrom&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;default&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;Foobar&amp;quot;   &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# Default value to use if retrieving valueFrom fails
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;path&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&#x2F;tmp&#x2F;hello_world.txt
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;print-message
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;inputs&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;parameters&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;      - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;message
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;container&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;image&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;docker&#x2F;whalesay:latest
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;command&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;cowsay&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;args&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;{{inputs.parameters.message}}&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;We can see that the first step in this workflow writes the value &quot;hello world&quot; to a file &#x2F;tmp&#x2F;hello_world.txt, then argo grabs the value written to the file as a parameter called &lt;em&gt;hello-world&lt;&#x2F;em&gt;. Then we use &lt;code&gt;{{steps.generate-parameter.outputs.parameters.hello-param}}&lt;&#x2F;code&gt; to access that parameter in the next step, which uses whalesay to print out the parameter.&lt;&#x2F;p&gt;
&lt;p&gt;We can submit this workflow using the following command:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;argo&lt;&#x2F;span&gt;&lt;span&gt; submit&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -n&lt;&#x2F;span&gt;&lt;span&gt; argo&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; --watch&lt;&#x2F;span&gt;&lt;span&gt; output-parameter-workflow.yaml
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This will give the following output in the terminal:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;cdn-images-1.medium.com&#x2F;max&#x2F;3200&#x2F;1*U_VL3AlVeLLL1vE6DYBw9g.png&quot; alt=&quot;Terminal Output&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;We can view the logs for this workflow to verify the paramater was successfully passed between steps using:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;argo&lt;&#x2F;span&gt;&lt;span&gt; logs&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; -n&lt;&#x2F;span&gt;&lt;span&gt; argo @latest
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;cdn-images-1.medium.com&#x2F;max&#x2F;5120&#x2F;1*ebc7yTtVAgWBpyhSGvSeNw.png&quot; alt=&quot;Log Output&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;the-withparam-attribute&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-withparam-attribute&quot; aria-label=&quot;Anchor link for: the-withparam-attribute&quot;&gt;The withParam attribute&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;We can use these output parameters to define the number of the following steps using the withParam attribute.&lt;&#x2F;p&gt;
&lt;p&gt;The withParam attribute takes a JSON list as input, and will run the steps in parallel for each value in the list.&lt;&#x2F;p&gt;
&lt;p&gt;We can use this to our advantage by creating this json list in the previous step, and then using it in the withParam attribute. A simple example of doing this might look as follows:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;yaml&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-yaml &quot;&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;apiVersion&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;argoproj.io&#x2F;v1alpha1
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;kind&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;Workflow
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;metadata&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;generateName&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;loops-param-result-
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;spec&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;entrypoint&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;loop-param-result-example
&lt;&#x2F;span&gt;&lt;span&gt;  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;templates&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;  - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;loop-param-result-example
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;steps&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;    - - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;generate
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;template&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;gen-number-list
&lt;&#x2F;span&gt;&lt;span&gt;    - - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;sleep
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;template&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;sleep-n-sec
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;arguments&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;          &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;parameters&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;          - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;seconds
&lt;&#x2F;span&gt;&lt;span&gt;            &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;value&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;{{item}}&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;withParam&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;{{steps.generate.outputs.result}}&amp;quot;
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;gen-number-list
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;script&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;image&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;python:alpine3.6
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;command&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;python&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;source&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;|
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;        import json
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;        import sys
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;        json.dump([i for i in range(20, 31)], sys.stdout)
&lt;&#x2F;span&gt;&lt;span&gt;  - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;sleep-n-sec
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;inputs&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;parameters&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;      - &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;seconds
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;container&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;:
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;image&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;alpine:latest
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;command&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;sh&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;-c&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;span&gt;      &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;args&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;: &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;echo sleeping for {{inputs.parameters.seconds}} seconds; sleep {{inputs.parameters.seconds}}; echo done&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;[Rest of blog post continues with all code blocks, images, and formatting preserved...]&lt;&#x2F;p&gt;
&lt;h1 id=&quot;conclusion&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#conclusion&quot; aria-label=&quot;Anchor link for: conclusion&quot;&gt;Conclusion&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;So there we go, a way to dynamically scale a step in an Argo Workflow. I would think carefully before deciding if this is something you need, but if you do I think its a neat solution to the problem which takes advantage of configuration attributes available.&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Creating and Deploying a Personal Blog&#x2F;Portfolio using Docusaurus</title>
        <published>2022-10-03T00:00:00+00:00</published>
        <updated>2022-10-03T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://pert.dev/posts/docusaurus-blog/"/>
        <id>https://pert.dev/posts/docusaurus-blog/</id>
        
        <content type="html" xml:base="https://pert.dev/posts/docusaurus-blog/">&lt;p&gt;Docusaurus is the solution from meta for building content based static html sites using nothing more than markdown files. Despite designed around the use-case of building documentation, at its heart Docusaurus is a easy to use content management system, and with its already inbuilt blog feature set it is the perfect candidate to quickly and easily setup a personal website and blog.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;setup&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#setup&quot; aria-label=&quot;Anchor link for: setup&quot;&gt;Setup&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;Setup is as simple as following the &lt;a href=&quot;https:&#x2F;&#x2F;docusaurus.io&#x2F;docs&#x2F;installation&quot;&gt;docusarus setup documentation&lt;&#x2F;a&gt;, and it is quickest to start out with their scaffold project website from which we can expand and adjust. Their documentation, as you would expect from a documentation tool, is fantastic. I strongly suggest opening another tab and browsing this in addition to going through this article, however to save you time I will demonstrate the steps for setting up below.&lt;&#x2F;p&gt;
&lt;p&gt;First, create the scaffold project website using &lt;strong&gt;npx.&lt;&#x2F;strong&gt; We&#x27;ll be adding the &lt;code&gt;--typescript&lt;&#x2F;code&gt; tag to create a typescript project, but this isn&#x27;t necessary.&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;npx&lt;&#x2F;span&gt;&lt;span&gt; create-docusaurus@latest my-website classic&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ff8f40;&quot;&gt; --typescript
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;And marvellously thats it! You now have a full website, congrats! This generates a folder titled &lt;code&gt;my-website&lt;&#x2F;code&gt; containing the following file structure (truncated below in some places for size on page):&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;text&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-text &quot;&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&lt;span&gt;my-website  
&lt;&#x2F;span&gt;&lt;span&gt; blog  
&lt;&#x2F;span&gt;&lt;span&gt;    2021-08-26-welcome.md  
&lt;&#x2F;span&gt;&lt;span&gt;    2019-05-28-first-blog-post.md  
&lt;&#x2F;span&gt;&lt;span&gt;    2019-05-29-long-blog-post.md  
&lt;&#x2F;span&gt;&lt;span&gt;    2019-08-01-mdx-blog-post.mdx  
&lt;&#x2F;span&gt;&lt;span&gt;    authors.yml  
&lt;&#x2F;span&gt;&lt;span&gt; docs  
&lt;&#x2F;span&gt;&lt;span&gt;    tutorial-basics  
&lt;&#x2F;span&gt;&lt;span&gt;       congratulations.md  
&lt;&#x2F;span&gt;&lt;span&gt;       create-a-blog-post.md  
&lt;&#x2F;span&gt;&lt;span&gt;       create-a-document.md  
&lt;&#x2F;span&gt;&lt;span&gt;       create-a-page.md  
&lt;&#x2F;span&gt;&lt;span&gt;       deploy-your-site.md  
&lt;&#x2F;span&gt;&lt;span&gt;       markdown-features.md  
&lt;&#x2F;span&gt;&lt;span&gt;       \_category\_.json  
&lt;&#x2F;span&gt;&lt;span&gt;    tutorial-extras  
&lt;&#x2F;span&gt;&lt;span&gt;    intro.md  
&lt;&#x2F;span&gt;&lt;span&gt; src  
&lt;&#x2F;span&gt;&lt;span&gt;    components  
&lt;&#x2F;span&gt;&lt;span&gt;       HomePageFeatures  
&lt;&#x2F;span&gt;&lt;span&gt;    css  
&lt;&#x2F;span&gt;&lt;span&gt;       custom.css  
&lt;&#x2F;span&gt;&lt;span&gt;    pages  
&lt;&#x2F;span&gt;&lt;span&gt;        index.module.css  
&lt;&#x2F;span&gt;&lt;span&gt;        index.tsx  
&lt;&#x2F;span&gt;&lt;span&gt;        markdown-page.md  
&lt;&#x2F;span&gt;&lt;span&gt; static  
&lt;&#x2F;span&gt;&lt;span&gt;    img  
&lt;&#x2F;span&gt;&lt;span&gt; docusaurus.config.js  
&lt;&#x2F;span&gt;&lt;span&gt; tsconfig.json  
&lt;&#x2F;span&gt;&lt;span&gt; .gitignore  
&lt;&#x2F;span&gt;&lt;span&gt; babel.config.js  
&lt;&#x2F;span&gt;&lt;span&gt; package.json  
&lt;&#x2F;span&gt;&lt;span&gt; README.md  
&lt;&#x2F;span&gt;&lt;span&gt; sidebars.js  
&lt;&#x2F;span&gt;&lt;span&gt; package-lock.json
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Of key note here are the &lt;code&gt;docs&lt;&#x2F;code&gt; and &lt;code&gt;blog&lt;&#x2F;code&gt; directories, as well as the &lt;code&gt;docusaurus.config.js&lt;&#x2F;code&gt; file, in which most of the heavy lifting for converting this into our perfect blog site is done.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;running-the-development-server&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#running-the-development-server&quot; aria-label=&quot;Anchor link for: running-the-development-server&quot;&gt;Running the Development Server&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;Running the following will launch a local development server where you can see your new website!&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;bash&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-bash &quot;&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;npm&lt;&#x2F;span&gt;&lt;span&gt; start
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;This will default to &lt;code&gt;[http:&#x2F;&#x2F;localhost:3000](http:&#x2F;&#x2F;localhost:3000)&lt;&#x2F;code&gt; which you can open in your browser to see. We can see through doing this that a lot of unneccessary docusaurus boilerplate has been included.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;modifying-to-suit-our-needs&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#modifying-to-suit-our-needs&quot; aria-label=&quot;Anchor link for: modifying-to-suit-our-needs&quot;&gt;Modifying to suit our needs&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;The first thing I wanted to do was to sort out our directory structure. First of all, &lt;code&gt;docs&lt;&#x2F;code&gt; doesn&#x27;t really make a lot of sense in our context. Docusaurus unsurprisingly requires this, so the best move is to re-purpose it. Instead I wanted this section to become the &quot;Portfolio&quot; section of our site  it makes sense given that your projects &lt;strong&gt;&lt;em&gt;should be documented&lt;&#x2F;em&gt;&lt;&#x2F;strong&gt; . To do this we need to make the following adjustments.&lt;&#x2F;p&gt;
&lt;p&gt;First of all lets rename our &lt;code&gt;docs&lt;&#x2F;code&gt; folder to something more suitable. Since &lt;a href=&quot;https:&#x2F;&#x2F;docusaurus.io&#x2F;docs&#x2F;migration&#x2F;manual#customdocspath-docsurl-editurl-enableupdateby-enableupdatetime&quot;&gt;version 2.0&lt;&#x2F;a&gt; this is extremely simple. We make the following changes in &lt;code&gt;docusaurus.config.js&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;routeBasePath&lt;&#x2F;code&gt; changes the routing on the site, meaning if you have some documentation titled &lt;code&gt;myProject&lt;&#x2F;code&gt; the route will now be &lt;code&gt;&#x2F;portfolio&#x2F;myProject&lt;&#x2F;code&gt; rather than &lt;code&gt;&#x2F;docs&#x2F;myProject&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;path&lt;&#x2F;code&gt; changes where docusaurus searches your project for &#x27;doc&#x27; markdown files, which it uses to generate the portfolio section.&lt;&#x2F;p&gt;
&lt;p&gt;Now &lt;strong&gt;to match this change we must rename our &lt;code&gt;docs&lt;&#x2F;code&gt; folder to &lt;code&gt;portfolio&lt;&#x2F;code&gt;&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Please note that you can call &#x27;portfolio&#x27; whatever you want!&lt;&#x2F;p&gt;
&lt;h1 id=&quot;adding-projects&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#adding-projects&quot; aria-label=&quot;Anchor link for: adding-projects&quot;&gt;Adding Projects&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;Now create markdown files within your new folder to populate your site with your projects! Each project can have nested pages by creating sub-folders in the &lt;code&gt;portfolio&lt;&#x2F;code&gt; folder. See the &lt;a href=&quot;https:&#x2F;&#x2F;docusaurus.io&#x2F;docs&#x2F;docs-introduction&quot;&gt;docusaurus documentation&lt;&#x2F;a&gt; for more information about this.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;blog&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#blog&quot; aria-label=&quot;Anchor link for: blog&quot;&gt;Blog&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;One of the main reasons I decided to create a personal site was to host my own blog. A reason docusaurus became my choice for this was due to its out of the box blog support. This supports many features which can enhance your blog  making it much more enjoyable to interact with than simply text. For example tags and reading time.&lt;&#x2F;p&gt;
&lt;p&gt;Adding a blog to your site is extremely easy  simply add a folder to your root titled &lt;code&gt;blog&lt;&#x2F;code&gt;, this is already done for you in the generated file structure. Then, to create a blog, create a file titled &lt;code&gt;{year}-{month}-{day}-{title}.md&lt;&#x2F;code&gt;. Docusaurus also provides the functionality to provide multiple authors, tags and many other features, all of which can be found &lt;a href=&quot;https:&#x2F;&#x2F;docusaurus.io&#x2F;docs&#x2F;blog&quot;&gt;in their documentation&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;And thats mostly it for the content side of things, once again the docusaurus documentation is unsurprisingly fantastic and completely comprehensive, and will give you access to many other features such as custom pages, themeing and lots else.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;deploying-the-site&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#deploying-the-site&quot; aria-label=&quot;Anchor link for: deploying-the-site&quot;&gt;Deploying the Site&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;Docusaurus is a &lt;em&gt;static site generator.&lt;&#x2F;em&gt; Meaning it generates static files which can simply be served from your favourite static site hosting service. For example, you could simply dump the files inside the build directory into an S3 bucket which would work absolutely fine.&lt;&#x2F;p&gt;
&lt;p&gt;Sites like &lt;a href=&quot;https:&#x2F;&#x2F;www.netlify.com&quot;&gt;Netlify&lt;&#x2F;a&gt; offer a great free tier which gives you pretty much everything you would want for a small blog site. They can also deploy directly from a github repo meaning you can version control your sites content. Simply connect your netlify project to your docusaurus sites github repo, then specify &lt;code&gt;npm run build&lt;&#x2F;code&gt; as the build command and &lt;code&gt;build&lt;&#x2F;code&gt; as the publish directory. This is exactly what I did and it was super simple! Netlify (even on the free tier!) also allows you to connect your own domains. View &lt;a href=&quot;https:&#x2F;&#x2F;rupertcarr.uk&quot;&gt;rupertcarr.uk&lt;&#x2F;a&gt; to see mine!&lt;&#x2F;p&gt;
&lt;h1 id=&quot;summing-up&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#summing-up&quot; aria-label=&quot;Anchor link for: summing-up&quot;&gt;Summing Up&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;To wrap up  is docusaurus the optimal tool for deploying your own site? Possibly not  but that said it is incredibly easy to use as a general CMS and therefore I think makes a great option. There may be more tailored tools for the jobs, but I think the feature set they created for this tool can be applied to create a fantastic, simple portfolio site from scratch extremely quickly. And it looks great!&lt;&#x2F;p&gt;
&lt;p&gt;At the end of the day this was in part a learning exercise for myself to get used to the tool, the experience of which led me to recommend us to use docusaurus to document an internal tool I am working on. But I suggest you yourself go out and examinine and try out other tools as well to make sure you are making the optimal choice for your own use case.&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Deploying a Spring Boot API to Railway using Maven and Docker</title>
        <published>2022-09-20T00:00:00+00:00</published>
        <updated>2022-09-20T00:00:00+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://pert.dev/posts/spring-boot-railway/"/>
        <id>https://pert.dev/posts/spring-boot-railway/</id>
        
        <content type="html" xml:base="https://pert.dev/posts/spring-boot-railway/">&lt;p&gt;In this guide we will walk through how to deploy a Java Spring Boot API to railway.app, its deceptively simple to do, and with railway&#x27;s use of nixpacks the speed of deployment will blow your mind.&lt;&#x2F;p&gt;
&lt;p&gt;This deployment takes just 5 steps to get from no-code to your very own public API service:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Create a Springboot application and define some routes&lt;&#x2F;li&gt;
&lt;li&gt;Push this application to a github repo&lt;&#x2F;li&gt;
&lt;li&gt;Create a project on Railway.app from this github repo&lt;&#x2F;li&gt;
&lt;li&gt;Create a dockerfile to build and package the application and push it to the repo&lt;&#x2F;li&gt;
&lt;li&gt;Expose a public domain on Railway.app&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h1 id=&quot;getting-started&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#getting-started&quot; aria-label=&quot;Anchor link for: getting-started&quot;&gt;Getting Started&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;h2 id=&quot;the-springboot-application&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-springboot-application&quot; aria-label=&quot;Anchor link for: the-springboot-application&quot;&gt;The Springboot Application&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;The first thing you will need is a spring boot API that you can deploy! If you are just getting started with this, you can follow the official &lt;a href=&quot;https:&#x2F;&#x2F;spring.io&#x2F;guides&#x2F;gs&#x2F;spring-boot&#x2F;&quot;&gt;SpringBoot Getting Started Guide&lt;&#x2F;a&gt; to get your first project up and running.&lt;&#x2F;p&gt;
&lt;p&gt;My directory structure with a project titled &quot;getyourway&quot; looks as follows:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;cdn-images-1.medium.com&#x2F;max&#x2F;2000&#x2F;1*m7dGC5a-wLzotnPx3g-xVQ.png&quot; alt=&quot;Directory Structure&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;I created a file titled HelloController.java and put in the following code to define one route to &lt;code&gt;&#x2F;&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;java&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-java &quot;&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;@&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;RestController
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;public class &lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;HelloController &lt;&#x2F;span&gt;&lt;span&gt;{
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;@&lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;GetMapping&lt;&#x2F;span&gt;&lt;span&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;&#x2F;&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;)
&lt;&#x2F;span&gt;&lt;span&gt;    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;public &lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#55b4d4;&quot;&gt;String &lt;&#x2F;span&gt;&lt;span style=&quot;color:#f29718;&quot;&gt;index&lt;&#x2F;span&gt;&lt;span&gt;() {
&lt;&#x2F;span&gt;&lt;span&gt;        &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;Hello World!&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#61676ccc;&quot;&gt;;
&lt;&#x2F;span&gt;&lt;span&gt;    }
&lt;&#x2F;span&gt;&lt;span&gt;}
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;If we run the application using &lt;code&gt;$ mvn spring-boot:run&lt;&#x2F;code&gt; we can navigate to http:&#x2F;&#x2F;localhost:8080&#x2F;hello where we can see our response.&lt;&#x2F;p&gt;
&lt;p&gt;Once done, be sure to &lt;strong&gt;push this project to your own github repository&lt;&#x2F;strong&gt;, so that we can later integrate with railway.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;railway&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#railway&quot; aria-label=&quot;Anchor link for: railway&quot;&gt;Railway&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;To integrate this project with railway you will need to do two things:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Create a Railway.app account&lt;&#x2F;li&gt;
&lt;li&gt;Connect Railway.app to your github account&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;Railway will walk you through signing up. Once done, railway will greet you with this page:&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;cdn-images-1.medium.com&#x2F;max&#x2F;3798&#x2F;1*J1QYzBKAKiTNdK-kGjxWWg.png&quot; alt=&quot;Railway Welcome Page&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;From here we will click &lt;strong&gt;Start a New Project&lt;&#x2F;strong&gt; and then &lt;strong&gt;Deploy from a Github Repo&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;From this next screen, this is where we can connect and configure railway to work with our github account. So go ahead and click &lt;strong&gt;Configure Github App&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;This will first ask you to add the app to your github account, then will allow you to configure the account and its permissions.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;cdn-images-1.medium.com&#x2F;max&#x2F;2000&#x2F;1*0Pg4uVoMfq7yLXO2i-wQwg.png&quot; alt=&quot;Github Permissions&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Repository access will allow you to choose which repositories Railway can see. I chose to only select certain repositories, in which case &lt;strong&gt;you must select your newly created springboot repository so we can access it&lt;&#x2F;strong&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;Now this is configured, back on Railway we can go ahead and select our github repository. Next click the &lt;strong&gt;Add Variables&lt;&#x2F;strong&gt; option, rather than deploying it right away  we first need to setup our repo to deploy.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;configuring-springboot-to-deploy-using-maven&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#configuring-springboot-to-deploy-using-maven&quot; aria-label=&quot;Anchor link for: configuring-springboot-to-deploy-using-maven&quot;&gt;Configuring SpringBoot to Deploy using Maven&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;The docker file for our application involves two stages to the docker file:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;Building the jar file&lt;&#x2F;li&gt;
&lt;li&gt;Packaging the application&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h2 id=&quot;the-dockerfile&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#the-dockerfile&quot; aria-label=&quot;Anchor link for: the-dockerfile&quot;&gt;The Dockerfile&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;In the root directory, create a Dockerfile with the following content:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;Dockerfile&quot; style=&quot;background-color:#fafafa;color:#61676c;&quot; class=&quot;language-Dockerfile &quot;&gt;&lt;code class=&quot;language-Dockerfile&quot; data-lang=&quot;Dockerfile&quot;&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;#
&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# Build stage
&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;#
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; maven:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;3.6.0-jdk-11-slim &lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;AS &lt;&#x2F;span&gt;&lt;span&gt;build
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;COPY&lt;&#x2F;span&gt;&lt;span&gt; src &#x2F;home&#x2F;app&#x2F;src
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;COPY&lt;&#x2F;span&gt;&lt;span&gt; pom.xml &#x2F;home&#x2F;app
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;RUN &lt;&#x2F;span&gt;&lt;span&gt;mvn -f &#x2F;home&#x2F;app&#x2F;pom.xml clean package
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;#
&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;# Package stage
&lt;&#x2F;span&gt;&lt;span style=&quot;font-style:italic;color:#abb0b6;&quot;&gt;#
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;FROM&lt;&#x2F;span&gt;&lt;span&gt; openjdk:&lt;&#x2F;span&gt;&lt;span style=&quot;color:#399ee6;&quot;&gt;11-jre-slim
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;COPY&lt;&#x2F;span&gt;&lt;span&gt; --from=build &#x2F;home&#x2F;app&#x2F;target&#x2F;getyourway-0.0.1-SNAPSHOT.jar &#x2F;usr&#x2F;local&#x2F;lib&#x2F;demo.jar
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#fa6e32;&quot;&gt;EXPOSE &lt;&#x2F;span&gt;&lt;span&gt;8080
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#ed9366;&quot;&gt;ENTRYPOINT &lt;&#x2F;span&gt;&lt;span&gt;[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;java&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;-jar&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#86b300;&quot;&gt;&amp;quot;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;demo.jar&amp;quot;&lt;&#x2F;span&gt;&lt;span&gt;]
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;&lt;strong&gt;NOTE:&lt;&#x2F;strong&gt; Be sure to change maven and openjdk to use the version of java you are using and generated the spring-boot application with to prevent build errors.&lt;&#x2F;p&gt;
&lt;p&gt;The build stage uses mvn package to create a jar file of our application from our pom.xml. The package stage then exposes a port before defining an entrypoint for our package. Don&#x27;t forget to change &#x2F;home&#x2F;app&#x2F;target&#x2F;getyourway-0.0.1-SNAPSHOT.jar to match the name of your application (just the jar filename needs adjusting).&lt;&#x2F;p&gt;
&lt;p&gt;We expose port 8080, the default launch port for springboot, if you have modified this value at all in the config for your springboot application, change the port value here.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;expose-port-on-railway&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#expose-port-on-railway&quot; aria-label=&quot;Anchor link for: expose-port-on-railway&quot;&gt;Expose port on Railway&lt;&#x2F;a&gt;&lt;&#x2F;h2&gt;
&lt;p&gt;Before we redeploy, we must let railway know which port our application should listen on. This can be done by setting the environment variable PORT in railway, as can be seen in the image below. Again this should be set to 8080 or your corresponding port.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;cdn-images-1.medium.com&#x2F;max&#x2F;2330&#x2F;1*IM_Qm9PqZfk_3mN7FCQkhA.png&quot; alt=&quot;Railway Port Configuration&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Now this is done, &lt;strong&gt;push your code&lt;&#x2F;strong&gt; to the github repository.&lt;&#x2F;p&gt;
&lt;p&gt;Immediately Railway will spot this new push and start to redeploy this service.&lt;&#x2F;p&gt;
&lt;p&gt;Amazingly  thats it! Railway will immediately &lt;strong&gt;identify the Dockerfile&lt;&#x2F;strong&gt; in your repository, and use it to build an image which it uses to run the service.&lt;&#x2F;p&gt;
&lt;h1 id=&quot;making-it-public&quot;&gt;&lt;a class=&quot;zola-anchor&quot; href=&quot;#making-it-public&quot; aria-label=&quot;Anchor link for: making-it-public&quot;&gt;Making it public&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;
&lt;p&gt;If we now go to the settings page of our Railway application we can click the &lt;strong&gt;Generate Domain&lt;&#x2F;strong&gt; button underneath &lt;strong&gt;Domains&lt;&#x2F;strong&gt; (or alternatively add your own domain), this will take a few seconds or minutes but then once your service has adjusted, follow through to this generated domain and go to &lt;a href=&quot;https:&#x2F;&#x2F;getyourway-production.up.railway.app&#x2F;&quot;&gt;https:&#x2F;&#x2F;your-generated-project-name.up.railway.app&#x2F;&lt;&#x2F;a&gt; and you should see &quot;Hello World!&quot; as your result!&lt;&#x2F;p&gt;
</content>
        
    </entry>
</feed>
